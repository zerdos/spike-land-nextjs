# =============================================================================
# SPIKE LAND ENVIRONMENT VARIABLES
# =============================================================================
#
# DOCUMENTATION: See docs/SECRETS_SETUP.md for complete setup instructions
# including how to obtain credentials from OAuth providers, generate secrets,
# and configure GitHub Actions and Vercel environments.
#
# QUICK START:
#   1. Copy this file: cp .env.example .env.local
#   2. Generate AUTH_SECRET: openssl rand -base64 32
#   3. Configure OAuth providers (GitHub, Google)
#   4. Start development: yarn dev
#
# =============================================================================

# Database Configuration
# PostgreSQL connection string format:
# postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=SCHEMA
#
# Examples:
# - Local: postgresql://postgres:password@localhost:5432/spike_land?schema=public
# - Supabase: postgresql://postgres:[YOUR-PASSWORD]@db.[PROJECT-REF].supabase.co:5432/postgres
# - Railway: postgresql://postgres:[PASSWORD]@[HOST]:[PORT]/railway
# - Neon: postgresql://[USER]:[PASSWORD]@[HOST]/[DATABASE]?sslmode=require
DATABASE_URL=postgresql://postgres:password@localhost:5432/spike_land?schema=public

# Production Database URL (Optional - for agent polling)
# When running `yarn agent:poll:prod`, uses this URL to connect to production database
# If not set, falls back to DATABASE_URL
# DATABASE_URL_PROD=postgresql://user:password@prod-host/database?sslmode=require

# Neon Database Branching (for staging management)
# Used by the staging reset workflow and yarn reset:db command
# Get API key from: https://console.neon.tech/app/settings/api-keys
# NEON_API_KEY=your-neon-api-key
# NEON_PROJECT_ID=dark-flower-44506554

# Database Connection Pooling (Production)
# Use connection pooling for serverless/edge environments
# DIRECT_URL is for migrations, DATABASE_URL is for queries
# DIRECT_URL=postgresql://postgres:password@localhost:5432/spike_land?schema=public

# NextAuth.js Configuration
# Generate a random secret for AUTH_SECRET:
# - Run: openssl rand -base64 32
# - Or visit: https://generate-secret.vercel.app/32
AUTH_SECRET=your-secret-key-here

# User ID Salt (Recommended for Production)
# Used to generate stable user IDs from email addresses.
# This ensures the same user gets the same ID across OAuth providers.
#
# IMPORTANT:
# - This value should NEVER be rotated once set in production
# - Changing this will cause all user IDs to change, breaking user data associations
# - If not set, AUTH_SECRET is used as fallback
# - Generate with: openssl rand -base64 32
#
# USER BEHAVIOR NOTE:
# - User IDs are tied to email addresses (user_<hash-of-email>)
# - If a user changes their email at the OAuth provider, they get a NEW user ID
# - This means they lose access to previous data (images, albums, tokens)
# - This is by design to maintain 1:1 email-to-identity relationship
#
# USER_ID_SALT=your-user-id-salt-here

# NextAuth URL (development)
# Production: Set this to your production domain (e.g., https://yourdomain.com)
NEXTAUTH_URL=http://localhost:3000

# GitHub OAuth Provider
# To obtain GitHub OAuth credentials:
# 1. Go to: https://github.com/settings/developers
# 2. Click "New OAuth App" or "New GitHub App"
# 3. Set Authorization callback URL to: http://localhost:3000/api/auth/callback/github
# 4. Copy Client ID and generate a Client Secret
GITHUB_ID=your-github-oauth-client-id
GITHUB_SECRET=your-github-oauth-client-secret

# Google OAuth Provider
# To obtain Google OAuth credentials:
# 1. Go to: https://console.cloud.google.com/
# 2. Create a new project or select existing one
# 3. Navigate to "APIs & Services" > "Credentials"
# 4. Click "Create Credentials" > "OAuth client ID"
# 5. Choose "Web application" as application type
# 6. Add authorized redirect URI: http://localhost:3000/api/auth/callback/google
# 7. Copy Client ID and Client Secret
GOOGLE_ID=your-google-oauth-client-id
GOOGLE_SECRET=your-google-oauth-client-secret

# Facebook OAuth Provider (Consumer Login)
# To obtain Facebook OAuth credentials:
# 1. Go to: https://developers.facebook.com/apps/
# 2. Create a new app with "Consumer" type (NOT "Business")
# 3. Select use case: "Authenticate and request data from users with Facebook Login"
# 4. Go to Use Cases > Customize > Settings
# 5. Add Valid OAuth Redirect URI: http://localhost:3000/api/auth/callback/facebook
# 6. For production, also add: https://yourdomain.com/api/auth/callback/facebook
# 7. Go to App Settings > Basic to get App ID and App Secret
# 8. Add your domain to "App Domains" in Basic Settings
#
# NOTE: Uses AUTH_ prefix to distinguish from FACEBOOK_MARKETING_APP_* (Marketing API)
AUTH_FACEBOOK_ID=your-facebook-oauth-app-id
AUTH_FACEBOOK_SECRET=your-facebook-oauth-app-secret

# Apple OAuth Provider (Sign in with Apple)
# Apple Sign-In requires a JWT-based client secret (not a static secret)
#
# To obtain Apple OAuth credentials:
# 1. Go to: https://developer.apple.com/account/
# 2. Navigate to Certificates, Identifiers & Profiles
#
# Step A - Create an App ID (if you don't have one):
# 3. Go to Identifiers > App IDs > Click "+"
# 4. Select "App IDs" and click Continue
# 5. Select "App" type and click Continue
# 6. Enter Description and Bundle ID (e.g., com.spike.land)
# 7. Enable "Sign in with Apple" capability
# 8. Click Continue and Register
#
# Step B - Create a Services ID (this is your CLIENT_ID):
# 9. Go to Identifiers > Services IDs > Click "+"
# 10. Select "Services IDs" and click Continue
# 11. Enter Description (e.g., "Spike Land Web") and Identifier (e.g., com.spike.land.web)
# 12. Click Continue and Register
# 13. Click on the newly created Services ID
# 14. Enable "Sign in with Apple" and click Configure
# 15. Select your Primary App ID from Step A
# 16. Add domains: spike.land (and localhost for dev)
# 17. Add Return URLs:
#     - https://spike.land/api/auth/callback/apple (production)
#     - http://localhost:3000/api/auth/callback/apple (development)
# 18. Click Save, then Continue, then Save
# 19. Copy the Identifier - this is your AUTH_APPLE_ID
#
# Step C - Create a Key for generating client secrets:
# 20. Go to Keys > Click "+"
# 21. Enter Key Name (e.g., "Spike Land Auth Key")
# 22. Enable "Sign in with Apple" and click Configure
# 23. Select your Primary App ID and click Save
# 24. Click Continue, then Register
# 25. IMPORTANT: Download the .p8 key file (you can only download it once!)
# 26. Note the Key ID shown on the page
#
# Step D - Generate the client secret JWT:
# 27. Run: yarn generate:apple-secret (see scripts/generate-apple-secret.ts)
#     Required inputs:
#     - Team ID: Found in top-right of Apple Developer portal (10 characters)
#     - Services ID: Your AUTH_APPLE_ID from Step B
#     - Key ID: From Step C (10 characters)
#     - Private Key: Contents of the .p8 file from Step C
#
# IMPORTANT: The client secret JWT expires after max 6 months!
# Set a calendar reminder to regenerate it before expiration.
#
AUTH_APPLE_ID=your-apple-services-id
AUTH_APPLE_SECRET=your-generated-jwt-secret
# Helper values for regenerating the secret (store securely, not in .env):
# APPLE_TEAM_ID=your-10-char-team-id
# APPLE_KEY_ID=your-10-char-key-id
# APPLE_PRIVATE_KEY_PATH=./path/to/AuthKey_XXXXXXXX.p8

# E2E Test Authentication Bypass
# Secret value used to bypass authentication in E2E tests
# - Generate a random secret: openssl rand -base64 32
# - The secret is sent as 'x-e2e-auth-bypass' header by Playwright tests
#
# Configuration Required:
# 1. LOCAL DEVELOPMENT:
#    - Set this in .env.local when running: npm run test:e2e:local
#
# 2. GITHUB ACTIONS CI/CD:
#    - Add to GitHub Secrets: https://github.com/YOUR-ORG/YOUR-REPO/settings/secrets/actions
#    - Name: E2E_BYPASS_SECRET
#    - Value: Same random secret (openssl rand -base64 32)
#
# 3. VERCEL RUNTIME (REQUIRED):
#    - Add to Vercel Environment Variables: https://vercel.com/YOUR-TEAM/YOUR-PROJECT/settings/environment-variables
#    - Name: E2E_BYPASS_SECRET
#    - Value: Same random secret as GitHub
#    - Environments: ✅ Preview, ✅ Development, ❌ Production (DO NOT enable for production)
#
# Why Both GitHub and Vercel?
# - GitHub Secrets: Used during CI/CD build pipeline and E2E test execution
# - Vercel Environment Variables: Used by middleware at runtime on Vercel's edge network
#
# Security Features:
# - Production Protection: Bypass is BLOCKED in production even if secret is configured
#   (requires both NODE_ENV=production AND VERCEL_ENV=production to block)
# - Constant-time Comparison: Uses timingSafeEqual to prevent timing attacks
# - Audit Logging: All bypass attempts are logged with timestamp and environment info
#
# E2E_BYPASS_SECRET=your-e2e-bypass-secret-here

# Google AI (Gemini + Imagen)
# Get your API key from: https://aistudio.google.com/app/apikey
# Used for image analysis (Gemini) and enhancement (Imagen)
GEMINI_API_KEY=your-gemini-api-key-here
# IMAGEN_API_KEY may be the same as GEMINI_API_KEY
# IMAGEN_API_KEY=your-imagen-api-key-here

# Cloudflare R2 Storage
# To obtain Cloudflare R2 credentials:
# 1. Go to: https://dash.cloudflare.com/
# 2. Select your account
# 3. Navigate to R2 > Overview
# 4. Create a bucket (e.g., spike-land-images)
# 5. Go to "Manage R2 API Tokens" > Create API Token
# 6. Copy Account ID, Access Key ID, and Secret Access Key
CLOUDFLARE_ACCOUNT_ID=your-cloudflare-account-id
CLOUDFLARE_R2_ACCESS_KEY_ID=your-r2-access-key-id
CLOUDFLARE_R2_SECRET_ACCESS_KEY=your-r2-secret-access-key
CLOUDFLARE_R2_BUCKET_NAME=spike-land-images

# Cloudflare Images API
# Used for image transformation and CDN delivery
# Get credentials from: https://dash.cloudflare.com/ > Images
CLOUDFLARE_IMAGES_API_KEY=your-images-api-key
CLOUDFLARE_IMAGES_ACCOUNT_HASH=your-account-hash

# Stripe Payment Integration
# Get credentials from: https://dashboard.stripe.com/apikeys
# Start with test keys (sk_test_... and pk_test_...)
# STRIPE_SECRET_KEY=sk_test_your-stripe-secret-key
# NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_your-stripe-publishable-key
# STRIPE_WEBHOOK_SECRET=whsec_your-webhook-secret

# Rate Limiting (Optional - Vercel KV)
# Only required if deploying to Vercel with rate limiting
# Get credentials from: https://vercel.com/dashboard (Storage > KV)
# KV_REST_API_URL=https://your-kv-url.vercel-storage.com
# KV_REST_API_TOKEN=your-kv-token

# Error Tracking
# This project uses structured logging (src/lib/error-logger.ts) combined with
# Vercel Analytics for monitoring. No external error tracking service is required.
# See docs/CEO_DECISIONS.md for the decision to not use Sentry.

# Resend Email Service
# Get API key from: https://resend.com/api-keys
# Used for transactional emails (welcome, purchase confirmations, etc.)
RESEND_API_KEY=re_your_resend_api_key_here
EMAIL_FROM=noreply@spike.land

# Meta Pixel (Client-Side Tracking)
# Get Pixel ID from: https://business.facebook.com/events_manager
# This is different from FACEBOOK_MARKETING_APP_ID - Pixel is for website tracking
# NEXT_PUBLIC_META_PIXEL_ID=   # 15-16 digit pixel ID

# Facebook Marketing API
# To obtain Facebook Marketing API credentials:
# 1. Go to: https://developers.facebook.com/apps/
# 2. Create a new app with "Business" type
# 3. Add "Marketing API" product
# 4. Configure OAuth redirect URIs
# 5. Get App ID and App Secret from Basic Settings
# Required permissions: ads_read, ads_management, business_management
FACEBOOK_MARKETING_APP_ID=your-facebook-app-id
FACEBOOK_MARKETING_APP_SECRET=your-facebook-app-secret

# Google Ads API
# To obtain Google Ads API credentials:
# 1. Uses same OAuth client as GOOGLE_ID/GOOGLE_SECRET (above)
# 2. Enable Google Ads API at: https://console.cloud.google.com/apis/library/googleads.googleapis.com
# 3. Apply for developer token at: https://ads.google.com/aw/apicenter
# 4. Get customer ID from your Google Ads account
GOOGLE_ADS_DEVELOPER_TOKEN=your-google-ads-developer-token
GOOGLE_ADS_CUSTOMER_ID=your-google-ads-customer-id

# Token Encryption (REQUIRED for production)
# Encrypts OAuth tokens stored in the database using AES-256-GCM
# Generate a 32-byte key with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# IMPORTANT: Do NOT rotate this key after tokens are stored - they will become unreadable
TOKEN_ENCRYPTION_KEY=your-64-character-hex-key-here

# Marketing OAuth Callback URLs (Optional)
# If not set, callbacks are computed from NEXTAUTH_URL or VERCEL_URL
# Set these if you need explicit control over callback URLs
# IMPORTANT: These must match EXACTLY what's configured in the OAuth provider
#
# For Google Ads, add these to Google Cloud Console > APIs & Credentials > OAuth 2.0 Client:
#   - http://localhost:3000/api/marketing/google/callback (development)
#   - https://yourdomain.com/api/marketing/google/callback (production)
#
# For Facebook, add to Facebook Developer Console > App Settings > Basic > OAuth Redirect URIs:
#   - http://localhost:3000/api/marketing/facebook/callback (development)
#   - https://yourdomain.com/api/marketing/facebook/callback (production)
#
# GOOGLE_ADS_CALLBACK_URL=https://yourdomain.com/api/marketing/google/callback
# FACEBOOK_CALLBACK_URL=https://yourdomain.com/api/marketing/facebook/callback

# =============================================================================
# SOCIAL MEDIA POSTING APIs
# =============================================================================
# These are for posting content to social media (distinct from marketing APIs)

# Twitter/X API v2
# To obtain Twitter API credentials:
# 1. Go to: https://developer.twitter.com/en/portal/dashboard
# 2. Sign up for a developer account (Free tier available)
# 3. Create a Project and App
# 4. Enable OAuth 2.0:
#    - Type: Web App (Confidential client)
#    - Callback URL: https://spike.land/api/social/twitter/callback
#    - Local dev: http://localhost:3000/api/social/twitter/callback
# 5. Copy Client ID and Client Secret
TWITTER_CLIENT_ID=your-twitter-client-id
TWITTER_CLIENT_SECRET=your-twitter-client-secret
TWITTER_CALLBACK_URL=https://spike.land/api/social/twitter/callback

# Facebook/Instagram Graph API (Social Posting)
# NOTE: This is DIFFERENT from FACEBOOK_MARKETING_APP_* (ads) and AUTH_FACEBOOK_* (login)
# To obtain credentials:
# 1. Go to: https://developers.facebook.com/
# 2. Create a new App (Type: Business)
# 3. Add Facebook Login and Instagram Graph API products
# 4. Configure OAuth:
#    - Redirect URI: https://spike.land/api/social/facebook/callback
#    - Local dev: http://localhost:3000/api/social/facebook/callback
# 5. Request permissions: pages_manage_posts, pages_read_engagement,
#    instagram_basic, instagram_content_publish
# 6. Copy App ID and App Secret from Basic Settings
FACEBOOK_SOCIAL_APP_ID=your-facebook-social-app-id
FACEBOOK_SOCIAL_APP_SECRET=your-facebook-social-app-secret
FACEBOOK_SOCIAL_CALLBACK_URL=https://spike.land/api/social/facebook/callback

# LinkedIn API (Social Posting)
# To obtain LinkedIn credentials:
# 1. Go to: https://www.linkedin.com/developers/apps
# 2. Create a new app (requires LinkedIn Page association)
# 3. Request access to: Marketing Developer Platform
# 4. Add OAuth 2.0 redirect URL: https://yourdomain.com/api/social/linkedin/callback
# 5. Copy Client ID and Client Secret
LINKEDIN_CLIENT_ID=your-linkedin-client-id
LINKEDIN_CLIENT_SECRET=your-linkedin-client-secret
LINKEDIN_CALLBACK_URL=https://spike.land/api/social/linkedin/callback

# YouTube Data API
# Uses Google OAuth - can share credentials with Google login
# Additional scopes required: youtube.readonly, youtube.force-ssl
# To enable YouTube API:
# 1. Go to: https://console.cloud.google.com/apis/library/youtube.googleapis.com
# 2. Enable YouTube Data API v3
# 3. Use same OAuth credentials as Google login (GOOGLE_ID/GOOGLE_SECRET)
# 4. Add callback URL: https://yourdomain.com/api/social/youtube/callback
YOUTUBE_CALLBACK_URL=https://spike.land/api/social/youtube/callback

# Discord Bot API
# To create a Discord bot:
# 1. Go to: https://discord.com/developers/applications
# 2. Create a new application
# 3. Go to Bot section and create a bot
# 4. Copy the bot token
# 5. Invite bot to your server with permissions: Send Messages, Read Message History
# 6. Get Server ID: Enable Developer Mode in Discord, right-click server → Copy ID
# 7. Get Channel ID: Right-click announcement channel → Copy ID
DISCORD_BOT_TOKEN=your-discord-bot-token
DISCORD_SERVER_ID=your-discord-server-id
DISCORD_ANNOUNCEMENT_CHANNEL_ID=your-announcement-channel-id

# Vercel Analytics API (for System Reports)
# Required for /api/reports/system endpoint to fetch analytics data
# Get access token from: https://vercel.com/account/tokens
# Create a token with "Full Account" or team-level access
# VERCEL_ACCESS_TOKEN=your-vercel-access-token
# VERCEL_TEAM_ID=team_xxxxxxxxxxxx  # Optional, for team projects
# VERCEL_PROJECT_ID=prj_xxxxxxxxxxxx  # Optional, auto-detected from VERCEL_URL

# =============================================================================
# VERCEL SANDBOX (Agent Execution)
# =============================================================================
# Vercel Sandbox runs Claude Agent SDK in isolated ephemeral VMs
# This is the recommended mode for production agent processing

# Feature flag to enable sandbox mode for agent execution
# Set to "true" to use Vercel Sandbox instead of local polling
# AGENT_USE_SANDBOX=false

# Vercel credentials for sandbox authentication (required when running locally)
# On Vercel, OIDC tokens are used automatically
# Get these from: https://vercel.com/account/tokens
# VERCEL_TOKEN=your-vercel-access-token
# VERCEL_TEAM_ID=team_xxxxxxxxxxxx
# VERCEL_PROJECT_ID=prj_xxxxxxxxxxxx

# Secret for sandbox callback authentication
# Generate with: openssl rand -hex 32
# This secret must match between the sandbox and your API
# SANDBOX_CALLBACK_SECRET=your-sandbox-callback-secret

# =============================================================================
# AGENT PROCESSING MODES
# =============================================================================
# Priority: SANDBOX > QUEUE > Direct SDK
#
# 1. AGENT_USE_SANDBOX=true - Vercel Sandbox (recommended for production)
#    Spawns ephemeral VMs with full Claude Agent SDK support
#    Supports up to 5 hours execution time (Pro plan)
#
# 2. AGENT_USE_QUEUE=true - Redis Queue + Local Poller
#    Messages are queued in Redis and processed by a local script
#    Requires running: yarn agent:poll:prod
#
# 3. Neither set - Direct SDK mode (development only)
#    Runs Claude Agent SDK directly in the API route
#    May fail on Vercel due to function timeout limits

# AGENT_USE_QUEUE=false
