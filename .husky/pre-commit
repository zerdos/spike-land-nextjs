# Run code formatter
yarn dprint
yarn tsc 
git add -u

# Secret detection with gitleaks
# Scans staged changes for accidentally committed secrets
# See: https://github.com/gitleaks/gitleaks
if command -v gitleaks &> /dev/null; then
  echo "Running gitleaks secret scan on staged files..."
  gitleaks git --staged --no-banner --verbose 2>&1 | head -50
  GITLEAKS_EXIT_CODE=${PIPESTATUS[0]}
  if [ $GITLEAKS_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "ERROR: gitleaks detected potential secrets in staged files!"
    echo "Please review the findings above and remove any sensitive data."
    echo ""
    echo "If this is a false positive, you can:"
    echo "  1. Add the pattern to .gitleaksignore"
    echo "  2. Use 'gitleaks:allow' comment inline (see gitleaks docs)"
    echo ""
    exit 1
  fi
  echo "No secrets detected."
else
  echo "WARNING: gitleaks is not installed. Skipping secret scan."
  echo "Install with: brew install gitleaks (macOS) or see https://github.com/gitleaks/gitleaks#installing"
fi
