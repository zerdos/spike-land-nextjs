---
title: "The Testing Pyramid Is Upside Down"
slug: "fog-of-war-in-your-ci-pipeline"
description: "Clausewitz warned that the fog of war kills more armies than bullets. For thirty years, our E2E tests have been fighting through that same fog -- async rendering, flaky selectors, timing races. MCP is the intelligence revolution that clears it."
date: "2026-02-13"
author: "Zoltan Erdos"
category: "Developer Experience"
tags: ["testing", "mcp", "military-strategy", "clausewitz", "ooda-loop", "fog-of-war"]
featured: false
listed: false
---

## The Fog of War

Carl von Clausewitz, the Prussian general whose *On War* remains the foundational text of military strategy, coined a concept that has haunted commanders ever since: *Nebel des Krieges* -- the fog of war. In theory, a battle is deterministic. In practice, commanders cannot see what is happening. Reports arrive late. Scouts contradict each other. The map disagrees with the terrain.

Clausewitz's insight was that the fog kills more armies than the enemy does. Not because generals are stupid, but because they are forced to make decisions based on delayed, distorted, incomplete information about the actual state of the battlefield.

This describes, with uncomfortable precision, what happens when you run a browser-based E2E test.

We did start testing UI. Selenium. Protractor. Cypress. Playwright. Each generation better than the last. And each one operating under the same constraint: you are observing your application through layers of fog. The DOM is a projection of state, not the state itself. CSS selectors are coordinates on a map that may not match the terrain. `waitForSelector` is a scout report that may arrive too late. `waitForTimeout` is a general staring at his watch, hoping the cavalry has arrived.

These tests are slow -- a comprehensive E2E suite runs in minutes. They are flaky -- an animation taking 50ms longer on CI produces a false negative. They are brittle -- change a CSS class and tests shatter like a formation caught in crossfire.

This is the testing pyramid. Unit tests at the base: fast, cheap, many -- your infantry. Integration tests in the middle -- your armored vehicles. E2E tests at the top: slow, expensive, few -- your air support. We accepted it as the cost of doing business, the way a general accepts that air strikes are expensive but sometimes necessary.

But the real problem was never the expense. It was the fog.

---

## The Intelligence Revolution

Sun Tzu wrote in *The Art of War* that "all warfare is based on deception" and that "what enables the wise sovereign and the good general to strike and conquer is foreknowledge." Intelligence -- not force -- determines the outcome. For centuries, the solution to the fog of war was brute force: send more scouts, build higher watchtowers. Then came signals intelligence. Satellite reconnaissance. The general who insists on observing troop positions through binoculars from five miles away loses to the one with satellite imagery -- not because binoculars are useless, but because they operate through too many layers of distortion.

MCP -- Model Context Protocol -- is the intelligence revolution for software testing. Text in, text out. An agent sends a request, your MCP server executes the action and returns the result. No browser. No DOM. No fog.

A typical E2E test for an email update flow:

```typescript
// Cypress E2E test -- observing through the fog
describe('Email update flow', () => {
  it('should allow user to change their email', () => {
    cy.login('test@example.com', 'password123');
    cy.visit('/settings');
    cy.get('[data-testid="email-input"]').clear().type('new@example.com');
    cy.get('[data-testid="save-button"]').click();
    cy.get('[data-testid="confirm-dialog"]').should('be.visible');
    cy.get('[data-testid="confirm-button"]').click();
    cy.get('[data-testid="success-toast"]').should('contain', 'Email updated');
    cy.visit('/profile');
    cy.get('[data-testid="user-email"]').should('contain', 'new@example.com');
  });
});
```

Every line is a scout report from behind the fog. The `data-testid` selectors are map coordinates that may not match the terrain. This test takes 5-15 seconds and breaks the moment anything shifts.

Now, the same business logic as an MCP tool and unit test -- satellite reconnaissance:

```typescript
// MCP tool -- direct intelligence
const updateEmailTool = {
  name: 'update_user_email',
  description: 'Update the authenticated user\'s email address',
  inputSchema: {
    type: 'object',
    properties: {
      newEmail: { type: 'string', format: 'email' },
      confirmChange: { type: 'boolean' },
    },
    required: ['newEmail', 'confirmChange'],
  },
  handler: async ({ newEmail, confirmChange }, context) => {
    const user = await context.getAuthenticatedUser();
    if (!user) return { error: 'Not authenticated' };
    if (!confirmChange) {
      return {
        status: 'confirmation_required',
        message: `Confirm change from ${user.email} to ${newEmail}?`,
      };
    }
    await context.userService.updateEmail(user.id, newEmail);
    return { status: 'success', updatedEmail: newEmail };
  },
};

// Unit test -- satellite reconnaissance
describe('update_user_email', () => {
  it('should update email when confirmed', async () => {
    const context = createMockContext({
      user: { id: '1', email: 'old@example.com' },
    });
    const result = await updateEmailTool.handler(
      { newEmail: 'new@example.com', confirmChange: true },
      context,
    );
    expect(result.status).toBe('success');
    expect(result.updatedEmail).toBe('new@example.com');
  });

  it('should reject unauthenticated requests', async () => {
    const context = createMockContext({ user: null });
    const result = await updateEmailTool.handler(
      { newEmail: 'new@example.com', confirmChange: true },
      context,
    );
    expect(result.error).toBe('Not authenticated');
  });
});
```

This test runs in milliseconds. No DOM, no timing, no fog. You have not lost any coverage. You have lost the fog.

---

## The OODA Loop

Colonel John Boyd never wrote a book. He gave briefings. His central concept was the OODA loop: Observe, Orient, Decide, Act. Boyd's thesis: the side with the tighter OODA loop wins. Not more firepower. Not better plans. Faster cycles.

A browser E2E test observes in 5-15 seconds. An MCP unit test observes in 5-15 milliseconds. That is a 1000x advantage in the Observe phase alone. Multiply by hundreds of tests, dozens of PRs per day, and a team of engineers, and you see the compounding cost of slow observation.

Boyd would have recognized the pyramid instantly. E2E tests are heavy bombers: devastating when they hit, but with long sortie times. Unit tests are fighter jets: fast, precise, responsive. The pyramid was always a force structure designed around available weapons. When the weapons change, the force structure must change too.

---

## Combined Arms

But both Clausewitz and Boyd would warn against the same mistake: do not eliminate a capability just because a better one exists. Modern militaries do not replace infantry with air power. They use combined arms -- each force type covering the weaknesses of the others.

MCP unit tests are your infantry -- fast, numerous, ground truth. They verify business logic at the speed of function calls. They hold the line.

E2E tests are your air support -- expensive, few, reserved for high-value targets. Visual regressions. Hydration bugs. CORS issues. Integration wiring that only manifests in a real environment. You keep them, but you deploy them surgically.

The pyramid does not flip. It becomes a force structure. Infantry at the broad base. Armor in the middle. Air support flies targeted missions. Each element does what it does best. Nothing carries more weight than it should.

---

## Three Players, One Truth

A unit test and its code, when both are written properly, specify each other. Two players, one truth.

But I think there is a third player: the name.

Consider `update_user_email`. That name is a constraint -- the way an order constrains a unit's mission. It tells you what the tool must do and what it must not do. An AI agent browsing your MCP server reads tool names, descriptions, and schemas. The name becomes a discoverable contract -- a mission objective that every unit in the chain of command can understand and execute against.

Test. Code. Name. Three players, one truth. The name, the input schema, and the handler form a triangle where each vertex constrains the other two. This is what military doctrine calls *unity of effort* -- when every element of your force structure knows its mission and can be independently assessed.

---

## Clearing the Fog

If you are staring at a flaky E2E suite right now, here is how to restructure your forces.

**Reconnaissance.** Identify your most painful E2E tests -- the ones with retry logic, `waitForTimeout`, the ones that pass locally and fail on CI. These units are fighting through the thickest fog.

**Intelligence extraction.** Ask what business logic each one actually verifies. Strip away the clicks and selectors. "User can cancel their subscription." "Payment handles declined cards." That is the ground truth hidden beneath the fog.

**Force restructuring.** Expose that logic as MCP tools. Write unit tests. Watch observation time drop from seconds to milliseconds.

**Maintain air cover.** Keep a thin layer of E2E tests for rendering, visual design, and browser-specific integration. Few, targeted, purposeful.

The savings compound. Running the full E2E suite for every PR is like launching a full air campaign because a single patrol encountered resistance. With MCP-structured logic, your CI runs only what matters. Less compute. Faster feedback. Tighter OODA loops.

---

## Full Circle

The real answer to the UI testing question was never "automate the browser harder" -- the way the real answer to the fog of war was never "build taller watchtowers." The answer was an intelligence revolution. A categorical shift from observing through distortion to observing directly.

Now we have it. Not heavier firepower. Better intelligence. Tighter loops. The boring kind of progress that clears the fog and lets you see the battlefield for what it actually is.
