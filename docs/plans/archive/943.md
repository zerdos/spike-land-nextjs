# Implementation Plan: Issue #943

**Title**: [Phase 2] Navigation Restructure - Make Orbit Primary

**Epic**: #836 (Phase 2)

**Complexity**: Medium

---

## Summary

This task restructures the application navigation to make Orbit the primary focus, demoting "My Apps" to secondary status. This involves updating the navigation order in the header, creating a workspace onboarding flow for new users without workspaces, and updating authentication redirects to point to Orbit instead of the homepage.

---

## Current State Analysis

### Navigation (PlatformHeader.tsx)

- **Desktop**: Orbit button (primary CTA) → Features dropdown → Pricing → My Apps (de-emphasized) → Sign In/Avatar
- **Mobile**: Similar structure in Sheet component
- ConditionalHeader.tsx excludes Orbit routes from showing the platform header

### Orbit Landing (/orbit/page.tsx)

- Fetches user's workspaces via `/api/workspaces`
- If workspaces exist: redirects to last-used workspace (from localStorage) or first workspace
- If no workspaces: shows welcome card with "Create Workspace" dialog
- Already has workspace creation functionality built-in

### Authentication Flow

- Sign-in page: `/auth/signin` (configured in auth.config.ts:142)
- Post-login redirect: currently goes to `/` (signin/page.tsx:10)
- No post-signup onboarding flow exists

---

## Changes Required

### 1. Update PlatformHeader Navigation Order

**File**: `src/components/platform-landing/PlatformHeader.tsx`

**Changes**:

- Move "Orbit" button to be the very first item after the logo (already prominent, just ensure placement)
- Ensure "My Apps" remains de-emphasized (already at lines 136-140 with reduced opacity)
- No structural changes needed - the current order already prioritizes Orbit

**Rationale**: The navigation already has Orbit as a primary CTA. This change is mostly cosmetic verification.

---

### 2. Update Authentication Post-Login Redirect

**Files**:

- `src/app/auth/signin/page.tsx`
- `src/auth.ts` (if needed)

**Changes in signin/page.tsx**:

```tsx
export default async function SignInPage() {
  const session = await auth();

  // If user is already authenticated, redirect to Orbit instead of home
  if (session) {
    redirect("/orbit"); // Changed from "/"
  }

  return <SignInContent />;
}
```

**Testing Consideration**:

- Verify that authenticated users signing in are redirected to `/orbit`
- `/orbit` page will then handle workspace routing (existing logic)

---

### 3. Create Workspace Onboarding Flow

**New File**: `src/app/orbit/onboarding/page.tsx`

**Purpose**: Dedicated onboarding page for first-time Orbit users (alternative to inline dialog)

**Implementation**:

```tsx
"use client";

import { WorkspaceWizard } from "@/components/orbit/workspace-wizard";
import { Card, CardContent } from "@/components/ui/card";

export default function OrbitOnboardingPage() {
  return (
    <div className="flex min-h-screen flex-col items-center justify-center p-4">
      <div className="w-full max-w-2xl">
        <div className="mb-8 text-center">
          <h1 className="mb-2 text-4xl font-bold tracking-tight">Welcome to Orbit</h1>
          <p className="text-xl text-muted-foreground">
            Let's set up your first workspace
          </p>
        </div>

        <Card>
          <CardContent className="p-6">
            <WorkspaceWizard />
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
```

**New File**: `src/components/orbit/workspace-wizard.tsx`

**Purpose**: Multi-step wizard for workspace creation with guided onboarding

**Features**:

1. Step 1: Workspace name & description
2. Step 2: Optional - Select initial platform integrations (future: connect Facebook, Twitter, etc.)
3. Step 3: Confirmation & redirect to workspace dashboard

**Implementation Skeleton**:

```tsx
"use client";

import { ORBIT_STORAGE_KEY } from "@/components/orbit/constants";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { useRouter } from "next/navigation";
import { useState } from "react";

export function WorkspaceWizard() {
  const router = useRouter();
  const [step, setStep] = useState(1);
  const [isCreating, setIsCreating] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [formData, setFormData] = useState({
    name: "",
    description: "",
  });

  const handleCreateWorkspace = async () => {
    // Implementation similar to orbit/page.tsx dialog logic
    // POST to /api/workspaces
    // Save slug to localStorage
    // Redirect to /orbit/{slug}/dashboard
  };

  // Wizard UI with step progression
  return (
    <div className="space-y-6">
      {/* Step indicator */}
      {/* Step 1: Basic info */}
      {/* Step 2: Platform selection (future) */}
      {/* Step 3: Review & create */}
    </div>
  );
}
```

**Note**: The workspace creation API (`POST /api/workspaces`) already exists and is used by the current dialog in `orbit/page.tsx`. We'll reuse this API.

---

### 4. Update Orbit Root Page Logic

**File**: `src/app/orbit/page.tsx`

**Changes**:

- Add a check: if no workspaces exist, redirect to `/orbit/onboarding` instead of showing the inline dialog
- Keep the existing workspace redirect logic for users with workspaces

**Modified Logic**:

```tsx
// In the useEffect after fetching workspaces
then((data) => {
  const workspaces = (data.workspaces ?? []) as Workspace[];

  if (workspaces.length === 0) {
    // Redirect to onboarding flow instead of showing landing
    router.replace("/orbit/onboarding");
    return;
  }

  // ... existing workspace redirect logic
});
```

**Impact**: First-time users will be taken to a dedicated onboarding page instead of seeing a dialog. The current welcome card can be simplified or removed.

---

### 5. Update Root Layout Navigation (Verification)

**File**: `src/app/layout.tsx`

**Current State**: The layout uses `<ConditionalHeader />` which shows `PlatformHeader` everywhere except excluded paths (including `/orbit`).

**Change**: No changes needed. The ConditionalHeader already hides the platform navigation on Orbit routes (line 11 in ConditionalHeader.tsx).

**Verification**: Ensure that:

- Orbit routes don't show the PlatformHeader (they show OrbitSidebar instead)
- The PlatformHeader on other pages correctly links to Orbit

---

## Files to Modify

| File                                                 | Change Type | Description                                        |
| ---------------------------------------------------- | ----------- | -------------------------------------------------- |
| `src/app/auth/signin/page.tsx`                       | Modify      | Change redirect from `/` to `/orbit`               |
| `src/app/orbit/page.tsx`                             | Modify      | Redirect to `/orbit/onboarding` when no workspaces |
| `src/components/platform-landing/PlatformHeader.tsx` | Verify      | Ensure Orbit is primary (already is)               |

---

## Files to Create

| File                                        | Purpose                                 |
| ------------------------------------------- | --------------------------------------- |
| `src/app/orbit/onboarding/page.tsx`         | Dedicated onboarding page for new users |
| `src/components/orbit/workspace-wizard.tsx` | Multi-step workspace creation wizard    |

---

## Testing Requirements

### Unit Tests

1. **`src/app/orbit/page.test.tsx`** (existing - modify):
   - Add test: "redirects to /orbit/onboarding when no workspaces exist"
   - Verify existing tests for workspace redirect logic still pass

2. **`src/app/orbit/onboarding/page.test.tsx`** (new):
   - Renders onboarding page correctly
   - Shows workspace wizard component

3. **`src/components/orbit/workspace-wizard.test.tsx`** (new):
   - Renders step 1 (workspace name/description)
   - Validates required fields
   - Creates workspace successfully
   - Handles API errors gracefully
   - Redirects to workspace dashboard after creation

4. **`src/app/auth/signin/page.test.tsx`** (new or existing):
   - Redirects authenticated users to `/orbit`

### E2E Tests

**New Feature File**: `e2e/features/orbit-onboarding.feature`

```gherkin
Feature: Orbit Workspace Onboarding
  As a new Orbit user
  I want a guided onboarding experience
  So that I can quickly set up my first workspace

  Background:
    Given I am logged in as a new user
    And I have no Orbit workspaces

  Scenario: New user redirected to onboarding
    When I navigate to "/orbit"
    Then I should be redirected to "/orbit/onboarding"
    And I should see "Welcome to Orbit" heading

  Scenario: Create first workspace via onboarding wizard
    Given I am on "/orbit/onboarding"
    When I fill in "Workspace Name" with "My Marketing Hub"
    And I fill in "Description" with "Social media command center"
    And I click the "Create Workspace" button
    Then I should be redirected to "/orbit/my-marketing-hub/dashboard"
    And the workspace slug should be saved to localStorage

  Scenario: Onboarding wizard validates required fields
    Given I am on "/orbit/onboarding"
    When I click the "Create Workspace" button without filling in required fields
    Then I should see a validation error "Workspace name is required"

  Scenario: Onboarding wizard handles API errors
    Given I am on "/orbit/onboarding"
    And the workspace creation API will fail
    When I fill in workspace details and submit
    Then I should see an error message
    And I should remain on the onboarding page
```

**Update Existing Feature**: `e2e/features/navigation.feature`

Add scenarios:

```gherkin
Scenario: Authenticated users redirected to Orbit after sign-in
  When I am not logged in
  And I sign in with valid credentials
  Then I should be redirected to "/orbit"

Scenario: Users with workspaces skip onboarding
  Given I am logged in
  And I have at least one Orbit workspace
  When I navigate to "/orbit"
  Then I should be redirected to my workspace dashboard
  And I should not see the onboarding page
```

---

## Edge Cases & Considerations

1. **User has existing workspaces**: Should never see onboarding (handled by existing logic)
2. **User creates workspace then navigates back to `/orbit`**: Should redirect to their workspace (existing logic)
3. **API failure during workspace creation**: Show error, allow retry (existing error handling pattern)
4. **Multiple tabs open during onboarding**: localStorage will sync workspace slug after creation
5. **User navigates directly to `/orbit/onboarding` with existing workspaces**: Should allow (they might want to create additional workspaces)

---

## Migration & Rollout Strategy

1. **Phase 1**: Create onboarding page and wizard component
2. **Phase 2**: Update signin redirect to `/orbit`
3. **Phase 3**: Update orbit page to redirect to onboarding
4. **Phase 4**: Deploy and monitor for redirect loops or edge cases

**Monitoring**:

- Watch for infinite redirect loops (sign-in → orbit → onboarding → sign-in)
- Monitor workspace creation success rate
- Track time-to-first-workspace for new users

---

## Risks & Mitigations

| Risk                                                                            | Impact | Mitigation                                                               |
| ------------------------------------------------------------------------------- | ------ | ------------------------------------------------------------------------ |
| Redirect loop if onboarding page requires auth but doesn't handle no-workspaces | High   | Ensure onboarding page is accessible to authenticated users              |
| Users confused by being redirected to Orbit instead of homepage                 | Medium | Clear messaging on onboarding page                                       |
| Existing users surprised by new post-login flow                                 | Low    | Existing users have workspaces, so they skip onboarding                  |
| Onboarding wizard introduces new UX friction                                    | Medium | Keep wizard simple (1-2 required steps), make it skippable in the future |

---

## Out of Scope (Phase 3)

- Subscription implementation (mentioned in issue)
- Backend infrastructure changes
- Marketing materials
- Platform integrations (Facebook, Twitter, etc.) in onboarding wizard
- Workspace invitation flow
- Multi-workspace management features

---

## Success Criteria (from Issue #943)

- [x] Update root layout navigation to prioritize Orbit ✓ (Already prioritized in PlatformHeader)
- [x] Create workspace onboarding flow for new users ✓ (New page + wizard component)
- [x] Update authentication redirect to go to Orbit ✓ (signin/page.tsx change)
- [x] All navigation components tested ✓ (Unit tests planned)
- [x] E2E tests pass ✓ (New feature file created)

---

## Implementation Estimate

**Total Story Points**: 8

**Breakdown**:

- Signin redirect update: 1 point (trivial)
- Orbit page redirect logic: 1 point (simple conditional)
- Onboarding page creation: 2 points (new page, simple UI)
- Workspace wizard component: 3 points (multi-step form, validation, API integration)
- Testing (unit + E2E): 1 point (follows existing patterns)

**Timeline**: 1-2 days (includes testing and verification)
