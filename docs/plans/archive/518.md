# Implementation Plan: Issue #518 - Full Platform Integration (TikTok, Pinterest, YouTube, Snapchat)

**Issue:** #518
**Title:** [Epic] Full Platform Integration - TikTok, Pinterest, YouTube
**Planning Date:** 2026-01-29
**Complexity:** High (Epic with 4 major stories)

## Summary

Expand Spike Land's Orbit platform to support TikTok, Pinterest, enhanced YouTube, and Snapchat integrations. This enables users to manage content, scheduling, and analytics across all major social platforms from a unified dashboard. The epic includes OAuth flows, posting/scheduling capabilities, analytics collection, and integration into the unified stream and inbox systems.

## Current State Analysis

### Fully Implemented Platforms

- **Twitter** - OAuth 2.0 PKCE, posting, metrics, stream support ✅
- **Facebook** - OAuth 2.0, posting, page management, comments ✅
- **Instagram** - OAuth via Facebook, media containers, metrics ✅
- **LinkedIn** - OAuth 2.0, organization management, posting ✅
- **Discord** - Bot authentication, guild management, messages ✅

### Partially Implemented Platforms

- **YouTube** (`src/lib/social/clients/youtube.ts`, 806 lines)
  - ✅ OAuth 2.0 (Google) implemented
  - ✅ Channel info retrieval
  - ✅ Video listing and metrics
  - ❌ Video uploads (stubbed - requires YouTube Studio or resumable upload API)
  - ❌ OAuth callback route missing
  - ❌ Inbox collector missing
  - ❌ Not integrated into stream/inbox

### Not Implemented Platforms (Stubbed)

- **TikTok** - Stub throws error: "Platform TIKTOK is not yet implemented"
- **Pinterest** - Not in enum yet, needs full implementation
- **Snapchat** - Not in enum yet, needs full implementation

### Database Schema Status

- `SocialPlatform` enum in Prisma includes: TWITTER, LINKEDIN, FACEBOOK, INSTAGRAM, TIKTOK, YOUTUBE, DISCORD
- **Missing:** PINTEREST, SNAPCHAT need to be added to enum
- `SocialAccount` model already supports all platforms with encrypted tokens
- `PLATFORM_CAPABILITIES` in `src/lib/social/types.ts` marks TIKTOK, YOUTUBE, DISCORD as not implemented (no like/reply/share)

## Architecture Overview

Each platform integration follows this consistent pattern:

1. **Client Class** (`src/lib/social/clients/{platform}.ts`)
   - Implements `ISocialClient` interface
   - OAuth 2.0 authentication flow
   - Normalized methods: getAccountInfo, createPost, getPosts, getMetrics
   - Platform-specific types and error handling

2. **OAuth Routes**
   - Connect: `src/app/api/social/{platform}/connect/route.ts`
   - Callback: `src/app/api/social/{platform}/callback/route.ts`
   - State management with CSRF protection
   - Token encryption and workspace-scoped storage

3. **Inbox Collector** (optional)
   - `src/lib/inbox/collectors/{platform}-collector.ts`
   - Extends `BaseCollector`
   - Fetches mentions, comments, DMs for unified inbox

4. **Stream Integration**
   - Factory function in `src/lib/social/index.ts`
   - Stream aggregator includes platform posts
   - Platform capabilities defined for UI interactions

## Implementation Breakdown

---

## ORB-051: Add TikTok Integration

**Priority:** High
**Complexity:** Medium
**API:** TikTok for Developers (Content Posting API + Display API)

### Phase 1: TikTok API Setup

**Developer Account Setup:**

1. Create TikTok Developer account at https://developers.tiktok.com/
2. Register application for "Content Posting API"
3. Obtain OAuth credentials (Client ID, Client Secret)
4. Configure callback URLs
5. Review rate limits and video upload requirements

**Environment Variables:**

```bash
# .env
TIKTOK_CLIENT_ID=your-tiktok-client-id
TIKTOK_CLIENT_SECRET=your-tiktok-client-secret
TIKTOK_CALLBACK_URL=https://spike.land/api/social/tiktok/callback
```

**Documentation:**

- TikTok Content Posting API: https://developers.tiktok.com/doc/content-posting-api-get-started/
- OAuth 2.0 Flow: https://developers.tiktok.com/doc/login-kit-web/
- Required Scopes: `user.info.basic`, `video.publish`, `video.list`

### Phase 2: TikTok Client Implementation

**File:** `src/lib/social/clients/tiktok.ts`

**Implementation Requirements:**

- Class `TikTokClient implements ISocialClient`
- OAuth 2.0 authorization URL generation
- Token exchange with code
- Refresh token support (90-day refresh tokens)
- User profile fetching
- Video upload flow (multi-part: init → upload → publish)
- Video listing with pagination
- Account metrics (followers, likes, views)

**Special Considerations:**

- TikTok requires video content (no text-only posts)
- Video uploads use chunked upload for large files
- Video processing takes time (use status polling)
- Max video size: 287.6 MB
- Supported formats: MP4, MOV, WebM
- Durations: 15s, 30s, 60s, 3min, 5min, 10min

**API Endpoints:**

- `POST /v2/post/publish/video/init/` - Initialize upload
- `POST /v2/post/publish/video/upload/` - Upload chunks
- `POST /v2/post/publish/video/publish/` - Publish video
- `GET /v2/user/info/` - User profile
- `GET /v2/video/list/` - User's videos

**Normalized Types:**

```typescript
// Map TikTok response to SocialAccountInfo
{
  platformId: user.open_id,
  username: user.unique_id,
  displayName: user.display_name,
  avatarUrl: user.avatar_url,
  followersCount: user.follower_count
}
```

**Test File:** `src/lib/social/clients/tiktok.test.ts`

- Mock TikTok API responses
- Test OAuth flow
- Test video upload initialization
- Test error handling

**Files to create:**

- `src/lib/social/clients/tiktok.ts` (~800 lines, similar to LinkedIn)
- `src/lib/social/clients/tiktok.test.ts` (~400 lines)

**Files to modify:**

- `src/lib/social/index.ts` (lines 59-60, 104-105)
  - Remove stub errors
  - Add TikTok case with dynamic import
- `src/lib/social/types.ts` (line 520)
  - Update PLATFORM_CAPABILITIES: `TIKTOK: { canLike: true, canReply: true, canShare: false }`

### Phase 3: TikTok OAuth Routes

**Connect Route:** `src/app/api/social/tiktok/connect/route.ts`

- Generate OAuth state with nonce
- Build authorization URL
- Set secure cookies for CSRF protection
- Redirect to TikTok authorization

**Callback Route:** `src/app/api/social/tiktok/callback/route.ts`

- Validate state and nonce
- Exchange code for tokens
- Fetch user profile
- Encrypt and store tokens in database
- Redirect to workspace settings with success/error

**Reference:** Copy patterns from `src/app/api/social/linkedin/` routes

**Files to create:**

- `src/app/api/social/tiktok/connect/route.ts` (~110 lines)
- `src/app/api/social/tiktok/callback/route.ts` (~280 lines)

### Phase 4: TikTok Stream & Inbox Integration

**Inbox Collector:** `src/lib/inbox/collectors/tiktok-collector.ts`

- Extend `BaseCollector`
- Fetch video comments via TikTok API
- Fetch mentions (if available in API)
- Transform to `InboxItem` format

**Files to create:**

- `src/lib/inbox/collectors/tiktok-collector.ts` (~200 lines)
- `src/lib/inbox/collectors/tiktok-collector.test.ts` (~150 lines)

**Files to modify:**

- `src/lib/inbox/collectors/index.ts` - Export TikTokCollector
- `src/lib/inbox/collection-job.ts` - Add TikTok to collector map

### Testing Requirements

- Unit tests for TikTok client (100% coverage)
- OAuth flow integration test
- Video upload mock test
- E2E test for connecting TikTok account
- E2E test for creating video post

---

## ORB-052: Add Pinterest Integration

**Priority:** High
**Complexity:** Medium
**API:** Pinterest API v5

### Phase 1: Pinterest API Setup

**Developer Account Setup:**

1. Create Pinterest Developer account at https://developers.pinterest.com/
2. Create app and obtain credentials
3. Configure redirect URIs
4. Review API rate limits (200 requests/hour for some endpoints)

**Environment Variables:**

```bash
PINTEREST_CLIENT_ID=your-pinterest-client-id
PINTEREST_CLIENT_SECRET=your-pinterest-client-secret
PINTEREST_CALLBACK_URL=https://spike.land/api/social/pinterest/callback
```

**Required Scopes:**

- `user_accounts:read` - User profile
- `boards:read`, `boards:write` - Board management
- `pins:read`, `pins:write` - Pin creation and listing

**Documentation:**

- Pinterest API: https://developers.pinterest.com/docs/api/v5/
- OAuth: https://developers.pinterest.com/docs/getting-started/authentication/

### Phase 2: Database Schema Update

**Prisma Migration:**

```prisma
// prisma/schema.prisma
enum SocialPlatform {
  TWITTER
  LINKEDIN
  FACEBOOK
  INSTAGRAM
  TIKTOK
  YOUTUBE
  DISCORD
  PINTEREST  // ADD THIS
}
```

**Migration File:** `prisma/migrations/YYYYMMDD_add_pinterest_snapchat/migration.sql`

```sql
ALTER TYPE "SocialPlatform" ADD VALUE 'PINTEREST';
```

**Files to modify:**

- `prisma/schema.prisma` (line ~2298)
- `src/lib/constants/social-platforms.ts` (line 13-21) - Add "PINTEREST" to array
- `src/lib/social/types.ts` (line 512-523) - Add Pinterest to PLATFORM_CAPABILITIES

### Phase 3: Pinterest Client Implementation

**File:** `src/lib/social/clients/pinterest.ts`

**Implementation Requirements:**

- Class `PinterestClient implements ISocialClient`
- OAuth 2.0 authorization
- User profile fetching
- Board listing and creation
- Pin creation (image + text + link)
- Pin listing with pagination
- Account metrics (followers, pins)

**Special Considerations:**

- Pinterest uses "boards" as containers for pins
- Pins require an image URL (hosted externally)
- Media type required: `image/jpeg`, `image/png`, `image/gif`
- Pin creation is two-step: upload image → create pin with image ID
- Board ID required for pin creation (need to store default board or let user select)

**API Endpoints:**

- `GET /v5/user_account` - User profile
- `GET /v5/boards` - List boards
- `POST /v5/boards` - Create board
- `POST /v5/pins` - Create pin
- `GET /v5/boards/{board_id}/pins` - List pins on board
- `POST /v5/media` - Upload media

**Normalized Types:**

```typescript
{
  platformId: user.id,
  username: user.username,
  displayName: user.business_name || user.username,
  profileUrl: user.profile_url,
  avatarUrl: user.profile_image,
  followersCount: user.follower_count
}
```

**Files to create:**

- `src/lib/social/clients/pinterest.ts` (~750 lines)
- `src/lib/social/clients/pinterest.test.ts` (~400 lines)

**Files to modify:**

- `src/lib/social/index.ts` - Add Pinterest case to factory functions

### Phase 4: Pinterest OAuth Routes

**Files to create:**

- `src/app/api/social/pinterest/connect/route.ts` (~100 lines)
- `src/app/api/social/pinterest/callback/route.ts` (~250 lines)

### Phase 5: Pinterest Stream & Inbox Integration

**Inbox Collector:** `src/lib/inbox/collectors/pinterest-collector.ts`

- Fetch pin comments (if available)
- Fetch board activity

**Files to create:**

- `src/lib/inbox/collectors/pinterest-collector.ts` (~180 lines)
- `src/lib/inbox/collectors/pinterest-collector.test.ts` (~120 lines)

### Testing Requirements

- Unit tests (100% coverage)
- OAuth integration test
- Pin creation test with board selection
- E2E test for connecting Pinterest account

---

## ORB-053: Add YouTube Full Integration

**Priority:** High
**Complexity:** Low (partial implementation exists)
**API:** YouTube Data API v3

### Current Implementation Analysis

**What Exists (✅):**

- `src/lib/social/clients/youtube.ts` (806 lines) - Full client implementation
- OAuth 2.0 with Google (getAuthUrl, exchangeCodeForTokens, refreshAccessToken)
- Channel info retrieval (getAccountInfo)
- Video listing (getPosts, getVideoById)
- Metrics fetching (getMetrics)
- Test file with good coverage

**What's Missing (❌):**

- OAuth connect/callback routes (no API routes exist)
- Video upload capability (createPost is stubbed)
- Inbox collector for comments
- Integration into stream aggregator
- YouTube not enabled in factory (throws "not implemented")

### Phase 1: OAuth Routes (High Priority)

YouTube client is fully implemented but **cannot be connected** because OAuth routes don't exist.

**Files to create:**

- `src/app/api/social/youtube/connect/route.ts` (~100 lines)
  - Use existing `YouTubeClient.getAuthUrl()`
  - Pattern: copy from LinkedIn connect route
  - Handle Google OAuth consent screen

- `src/app/api/social/youtube/callback/route.ts` (~270 lines)
  - Use existing `YouTubeClient.exchangeCodeForTokens()`
  - Store channel info in database
  - Handle multiple channels (Brand Accounts)

**Environment Variables:**
Already exist but document clearly:

```bash
YOUTUBE_CLIENT_ID=your-google-client-id
YOUTUBE_CLIENT_SECRET=your-google-client-secret
YOUTUBE_CALLBACK_URL=https://spike.land/api/social/youtube/callback
```

Note: Can reuse GOOGLE_CLIENT_ID/GOOGLE_CLIENT_SECRET if same OAuth app.

### Phase 2: Video Upload Implementation (Optional)

YouTube's `createPost()` method is currently stubbed with message:

> "YouTube videos must be uploaded through YouTube Studio or the resumable upload API"

**Decision Point:**

- **Option A:** Keep as read-only (view analytics, schedule descriptions/titles only)
- **Option B:** Implement resumable video upload (complex, requires video file handling)

**Recommendation:** Start with Option A (read-only). Video upload via browser is challenging (large files, network interruptions). Users can upload via YouTube Studio and manage metadata/analytics via Orbit.

If implementing uploads later:

- Use YouTube Data API v3 resumable uploads
- Require video files (can't create text-only posts)
- Implement chunked upload with retry logic
- Handle video processing delays

### Phase 3: Stream Integration

**Files to modify:**

- `src/lib/social/index.ts` (lines 51-54)
  - YouTube case already exists - just needs testing
  - Verify createPost handles "not supported" gracefully

- `src/lib/social/stream-aggregator.ts`
  - Add YouTube to platform list
  - Test fetching videos into unified stream

### Phase 4: Inbox Collector (Optional)

**File to create:** `src/lib/inbox/collectors/youtube-collector.ts`

YouTube API supports fetching:

- Video comments (`GET /commentThreads`)
- Comment replies (`GET /comments`)
- Channel discussions (deprecated)

**Implementation:**

- Fetch comments for workspace's videos
- Transform to InboxItem format
- Support reply functionality

**Files to create:**

- `src/lib/inbox/collectors/youtube-collector.ts` (~200 lines)
- `src/lib/inbox/collectors/youtube-collector.test.ts` (~150 lines)

### Phase 5: Platform Capabilities Update

**Files to modify:**

- `src/lib/social/types.ts` (line 522)
  ```typescript
  // Before
  YOUTUBE: { canLike: false, canReply: false, canShare: false },

  // After
  YOUTUBE: { canLike: true, canReply: true, canShare: false },
  ```

### Testing Requirements

- E2E test for YouTube OAuth connection
- Test video listing in stream
- Test fetching YouTube channel metrics
- Optional: Test video upload if implemented

---

## ORB-054: Add Snapchat Integration

**Priority:** Medium
**Complexity:** High
**API:** Snapchat Marketing API + Creative API

### Phase 1: Snapchat API Research

**Challenge:** Snapchat has two separate APIs:

1. **Marketing API** - For advertisers (campaigns, ads)
2. **Creative Kit/Login Kit** - For app integration

**Decision Point:** What does "Snapchat integration" mean for Orbit?

- **Option A:** Marketing API (ad campaigns, analytics for advertisers)
- **Option B:** Creative Kit (story posting for personal/brand accounts)
- **Option C:** Both (complex)

**Recommendation:** Start with **Marketing API** since Orbit focuses on business/marketing use cases. Personal Snapchat posting via Creative Kit is limited and requires mobile app integration.

**Developer Setup:**

1. Create Snapchat Business account
2. Apply for Marketing API access (requires business verification)
3. Create OAuth app in Business Manager
4. Obtain credentials

**Environment Variables:**

```bash
SNAPCHAT_CLIENT_ID=your-snapchat-client-id
SNAPCHAT_CLIENT_SECRET=your-snapchat-client-secret
SNAPCHAT_CALLBACK_URL=https://spike.land/api/social/snapchat/callback
```

**Required Scopes:**

- `snapchat-marketing-api` - Campaign management
- `creative-api` - Ad creative management

**Documentation:**

- Marketing API: https://developers.snap.com/api/marketing/
- Authentication: https://marketingapi.snapchat.com/docs/#authentication

### Phase 2: Database Schema Update

**Prisma Migration:**

```prisma
enum SocialPlatform {
  TWITTER
  LINKEDIN
  FACEBOOK
  INSTAGRAM
  TIKTOK
  YOUTUBE
  DISCORD
  PINTEREST
  SNAPCHAT  // ADD THIS
}
```

**Migration File:** Same as Pinterest migration above.

**Files to modify:**

- `prisma/schema.prisma` (line ~2298)
- `src/lib/constants/social-platforms.ts` (line 13-21) - Add "SNAPCHAT"
- `src/lib/social/types.ts` - Add to PLATFORM_CAPABILITIES

### Phase 3: Snapchat Client Implementation

**File:** `src/lib/social/clients/snapchat.ts`

**Implementation Requirements (Marketing API):**

- Class `SnapchatClient implements ISocialClient`
- OAuth 2.0 authorization
- User/organization profile fetching
- Ad account listing
- Campaign listing
- Ad creative listing
- Campaign metrics (impressions, swipe-ups, spend)

**Special Considerations:**

- Marketing API is account-based (not personal profiles)
- Requires ad account ID for most operations
- No "posting" in traditional sense - creates ad campaigns
- Metrics are advertising metrics (impressions, spend, conversions)

**Alternative: Creative Kit (for Stories)**
If implementing story posting:

- Requires mobile SDK integration
- Stories are ephemeral (24 hours)
- Limited API access
- Primarily for mobile apps, not web

**Decision:** Implement Marketing API first. Creative Kit can be added later if needed.

**API Endpoints (Marketing API):**

- `GET /v1/me` - Organization info
- `GET /v1/me/adaccounts` - Ad accounts
- `GET /v1/adaccounts/{id}/campaigns` - Campaigns
- `GET /v1/campaigns/{id}/stats` - Campaign stats
- `POST /v1/adaccounts/{id}/campaigns` - Create campaign

**Normalized Types:**

```typescript
{
  platformId: organization.id,
  username: organization.name,
  displayName: organization.display_name,
  profileUrl: null, // No public profile URL for org
  avatarUrl: null,
  followersCount: null // Marketing API doesn't expose follower count
}
```

**Files to create:**

- `src/lib/social/clients/snapchat.ts` (~600 lines)
- `src/lib/social/clients/snapchat.test.ts` (~350 lines)

**Files to modify:**

- `src/lib/social/index.ts` - Add Snapchat case

### Phase 4: Snapchat OAuth Routes

**Files to create:**

- `src/app/api/social/snapchat/connect/route.ts` (~100 lines)
- `src/app/api/social/snapchat/callback/route.ts` (~250 lines)

### Phase 5: Snapchat Analytics Integration

**Note:** Snapchat likely won't have inbox integration (Marketing API doesn't provide user comments/interactions).

Focus on analytics display:

- Campaign performance dashboard
- Ad creative metrics
- Spend tracking

**Files to modify:**

- `src/lib/allocator/allocator-service.ts` - Add Snapchat ad spend tracking
- `src/components/orbit/allocator/SpendOverviewCards.tsx` - Add Snapchat card

### Testing Requirements

- Unit tests (100% coverage)
- OAuth integration test
- Ad account listing test
- Campaign creation test (if implementing)
- E2E test for connecting Snapchat Marketing account

---

## Cross-Cutting Implementation Tasks

### Task 1: Update Constants and Types

**File:** `src/lib/constants/social-platforms.ts`

```typescript
export const SOCIAL_PLATFORMS = [
  "TWITTER",
  "LINKEDIN",
  "FACEBOOK",
  "INSTAGRAM",
  "TIKTOK",
  "YOUTUBE",
  "DISCORD",
  "PINTEREST", // ADD
  "SNAPCHAT", // ADD
] as const;
```

**File:** `src/lib/social/types.ts`

```typescript
export const PLATFORM_CAPABILITIES: Record<
  SocialPlatform,
  { canLike: boolean; canReply: boolean; canShare: boolean; }
> = {
  TWITTER: { canLike: true, canReply: true, canShare: true },
  FACEBOOK: { canLike: true, canReply: true, canShare: false },
  INSTAGRAM: { canLike: true, canReply: true, canShare: false },
  LINKEDIN: { canLike: true, canReply: true, canShare: false },
  TIKTOK: { canLike: true, canReply: true, canShare: false }, // UPDATE
  YOUTUBE: { canLike: true, canReply: true, canShare: false }, // UPDATE
  DISCORD: { canLike: false, canReply: true, canShare: false },
  PINTEREST: { canLike: true, canReply: true, canShare: false }, // ADD
  SNAPCHAT: { canLike: false, canReply: false, canShare: false }, // ADD
};
```

### Task 2: UI Components

**Platform Icons:**

- Add TikTok icon to `src/components/orbit/connections/ConnectionPlatformIcons.tsx`
- Add Pinterest icon
- Add Snapchat icon
- Ensure YouTube icon displays correctly

**Platform Selector:**

- Update `src/app/orbit/[workspaceSlug]/brand-brain/rewriter/components/PlatformSelector.tsx`
- Add new platform options

**Account Settings:**

- `src/app/orbit/[workspaceSlug]/settings/accounts/SocialAccountsClient.tsx`
- Verify all platforms display in connected accounts list
- Add connect buttons for new platforms

### Task 3: Documentation Updates

**Files to update:**

- `docs/API_REFERENCE.md` - Add OAuth endpoints for new platforms
- `docs/FEATURES.md` - Update Orbit platform support list
- `README.md` - Update platform list in overview

**Environment Variable Documentation:**
Create/update `docs/ENVIRONMENT_VARIABLES.md`:

```markdown
## Social Platform Integrations

### TikTok

- TIKTOK_CLIENT_ID
- TIKTOK_CLIENT_SECRET
- TIKTOK_CALLBACK_URL

### Pinterest

- PINTEREST_CLIENT_ID
- PINTEREST_CLIENT_SECRET
- PINTEREST_CALLBACK_URL

### YouTube

- YOUTUBE_CLIENT_ID (or GOOGLE_CLIENT_ID)
- YOUTUBE_CLIENT_SECRET (or GOOGLE_CLIENT_SECRET)
- YOUTUBE_CALLBACK_URL

### Snapchat

- SNAPCHAT_CLIENT_ID
- SNAPCHAT_CLIENT_SECRET
- SNAPCHAT_CALLBACK_URL
```

### Task 4: E2E Test Suite

**File:** `e2e/features/orbit-platforms.feature`

```gherkin
Feature: Social Platform Integrations

  Scenario: Connect TikTok account
    Given I am logged in as a workspace admin
    When I navigate to Orbit settings
    And I click "Connect TikTok"
    And I authorize TikTok OAuth
    Then I should see my TikTok account connected

  Scenario: Connect Pinterest account
    Given I am logged in as a workspace admin
    When I navigate to Orbit settings
    And I click "Connect Pinterest"
    And I authorize Pinterest OAuth
    Then I should see my Pinterest account connected

  Scenario: Connect YouTube account
    Given I am logged in as a workspace admin
    When I navigate to Orbit settings
    And I click "Connect YouTube"
    And I authorize Google OAuth
    Then I should see my YouTube channel connected

  Scenario: View unified stream with all platforms
    Given I have connected accounts on all platforms
    When I navigate to Orbit streams
    Then I should see posts from all platforms
    And I can filter by platform
```

**File:** `e2e/step-definitions/orbit-platforms.steps.ts`

- Implement step definitions
- Mock OAuth flows for testing
- Verify database state after connections

---

## Dependencies & Prerequisites

### External Dependencies

1. **Developer Accounts** - Must create and verify:
   - TikTok for Developers account
   - Pinterest Developer account
   - Google Cloud Console project (for YouTube)
   - Snapchat Business Manager account

2. **API Access Approvals**:
   - TikTok Content Posting API (requires app review)
   - Snapchat Marketing API (requires business verification)
   - Pinterest API (automatic for developers)
   - YouTube Data API v3 (automatic with Google Cloud project)

3. **OAuth App Configuration**:
   - Set redirect URIs in each platform's developer console
   - Configure scopes/permissions
   - Obtain client credentials
   - Test OAuth flows in sandbox/dev environments

### Internal Dependencies

1. **Phase 3 Complete** - As stated in issue #518 dependencies
2. **Token Encryption** - `src/lib/crypto/token-encryption.ts` (already exists)
3. **Workspace Permissions** - `src/lib/permissions/workspace-middleware.ts` (already exists)
4. **Base Collector** - `src/lib/inbox/base-collector.ts` (already exists)

---

## Database Migration Plan

### Migration 1: Add Pinterest and Snapchat to Enum

**File:** `prisma/migrations/20260130_add_pinterest_snapchat/migration.sql`

```sql
-- Add Pinterest and Snapchat to SocialPlatform enum
ALTER TYPE "SocialPlatform" ADD VALUE 'PINTEREST';
ALTER TYPE "SocialPlatform" ADD VALUE 'SNAPCHAT';
```

**Note:** Enum values can only be added (not removed or reordered) in PostgreSQL. Ensure correct spelling.

### Migration 2: Update Seed Data (Optional)

If there's seed data for social platforms, update:

- `prisma/seed.ts` or similar
- Add sample connections for new platforms

---

## Testing Strategy

### Unit Tests (Required for 100% Coverage)

- Each client file must have corresponding `.test.ts`
- Mock all external API calls
- Test OAuth flows (getAuthUrl, exchangeCodeForTokens, refreshAccessToken)
- Test CRUD operations (createPost, getPosts, getMetrics)
- Test error handling (rate limits, auth failures, invalid responses)
- Test type conversions (platform types → normalized types)

### Integration Tests

- Test OAuth callback routes with mock state
- Test database storage and retrieval of encrypted tokens
- Test workspace permission checks
- Test token refresh flows

### E2E Tests (Playwright + Cucumber)

- Test full OAuth connection flow for each platform
- Test viewing connected accounts in Orbit settings
- Test posting to each platform (where supported)
- Test viewing platform posts in unified stream
- Test filtering stream by platform
- Test inbox items from each platform

### Manual Testing Checklist

- [ ] TikTok OAuth connection works in production
- [ ] TikTok video upload works (if implemented)
- [ ] TikTok account displays in Orbit settings
- [ ] Pinterest OAuth connection works
- [ ] Pinterest pin creation works
- [ ] Pinterest boards display correctly
- [ ] YouTube OAuth connection works
- [ ] YouTube videos display in stream
- [ ] YouTube metrics display correctly
- [ ] Snapchat OAuth connection works (Marketing API)
- [ ] Snapchat ad accounts display
- [ ] All platforms visible in stream filters
- [ ] Inbox collectors work for supported platforms

---

## Rollout Plan

### Phase 1: YouTube (Quick Win)

**Duration:** 1-2 days
**Why:** Client already exists, just needs OAuth routes
**Deliverables:**

- YouTube OAuth connect/callback routes
- E2E connection test
- Stream integration verification

### Phase 2: TikTok

**Duration:** 4-5 days
**Why:** High user demand, modern platform
**Deliverables:**

- TikTok client implementation
- OAuth routes
- Video upload flow (or read-only decision)
- Inbox collector
- E2E tests

### Phase 3: Pinterest

**Duration:** 3-4 days
**Why:** Visual platform, good for brands
**Deliverables:**

- Database migration (add PINTEREST enum)
- Pinterest client implementation
- OAuth routes
- Board/pin management
- E2E tests

### Phase 4: Snapchat

**Duration:** 4-5 days
**Why:** Marketing API complexity
**Deliverables:**

- Database migration (add SNAPCHAT enum)
- Snapchat Marketing API client
- OAuth routes
- Ad account integration
- Analytics display
- E2E tests

### Phase 5: Integration & Polish

**Duration:** 2-3 days
**Deliverables:**

- Update all UI components with new platform icons
- Documentation updates
- E2E test suite for all platforms
- Performance testing with multiple platforms
- User acceptance testing

**Total Estimated Duration:** 14-19 days

---

## Risks & Mitigation

### Risk 1: API Access Approval Delays

**Impact:** High
**Probability:** Medium
**Mitigation:**

- Apply for API access early in the process
- Have backup plans for approval delays
- Implement platforms in parallel where possible
- Use sandbox/development environments for initial implementation

### Risk 2: Rate Limiting

**Impact:** Medium
**Probability:** High (especially TikTok, Pinterest)
**Mitigation:**

- Implement exponential backoff in clients
- Cache API responses where appropriate
- Use webhooks instead of polling where available
- Monitor rate limit headers and store in database
- Implement queue system for bulk operations

### Risk 3: OAuth Token Expiration

**Impact:** Medium
**Probability:** High (users forget to reauth)
**Mitigation:**

- Implement automatic token refresh before expiration
- Show user-friendly notifications when reauth needed
- Store token expiry dates in database
- Add health monitoring for connected accounts

### Risk 4: Video Upload Complexity (TikTok, YouTube)

**Impact:** High
**Probability:** Medium
**Mitigation:**

- Start with read-only implementations
- Document limitations clearly
- Consider async job queue for uploads
- Handle chunked uploads for large files
- Provide clear error messages for unsupported formats

### Risk 5: Platform API Changes

**Impact:** High
**Probability:** Low-Medium (ongoing concern)
**Mitigation:**

- Pin API versions where possible
- Monitor platform developer changelogs
- Implement comprehensive error logging
- Add version checks in API calls
- Create abstraction layer for platform-specific logic

### Risk 6: Snapchat Marketing API Scope

**Impact:** Medium
**Probability:** Low
**Mitigation:**

- Clarify requirements with stakeholders
- Document that Snapchat is marketing-focused (not personal posting)
- Consider Creative Kit integration as future enhancement
- Set clear expectations in UI/UX

---

## Acceptance Criteria

### ORB-051: TikTok Integration

- [ ] User can connect TikTok account via OAuth
- [ ] TikTok profile displays in Orbit settings
- [ ] TikTok videos display in unified stream
- [ ] TikTok metrics (followers, views) display correctly
- [ ] Video upload works OR is clearly marked as unsupported
- [ ] TikTok comments display in inbox (if implemented)
- [ ] Unit tests achieve 100% coverage
- [ ] E2E test passes for TikTok connection

### ORB-052: Pinterest Integration

- [ ] User can connect Pinterest account via OAuth
- [ ] Pinterest profile displays in Orbit settings
- [ ] Pinterest boards are accessible
- [ ] User can create pins with images
- [ ] Pins display in unified stream
- [ ] Pinterest metrics display correctly
- [ ] Unit tests achieve 100% coverage
- [ ] E2E test passes for Pinterest connection

### ORB-053: YouTube Full Integration

- [ ] User can connect YouTube channel via OAuth
- [ ] YouTube channel info displays in Orbit settings
- [ ] YouTube videos display in unified stream
- [ ] YouTube metrics (subscribers, views) display correctly
- [ ] Video comments display in inbox
- [ ] Unit tests achieve 100% coverage
- [ ] E2E test passes for YouTube connection

### ORB-054: Snapchat Integration

- [ ] User can connect Snapchat Business account via OAuth
- [ ] Snapchat ad accounts display in Orbit settings
- [ ] Snapchat campaigns display (if implementing Marketing API)
- [ ] Snapchat metrics display in analytics
- [ ] Unit tests achieve 100% coverage
- [ ] E2E test passes for Snapchat connection

### Epic-Level Acceptance Criteria

- [ ] All four platforms fully integrated
- [ ] Unified stream shows posts from all platforms
- [ ] Unified inbox works for applicable platforms
- [ ] Platform filtering works in stream and inbox
- [ ] Analytics dashboard includes all platforms
- [ ] Documentation updated with new platforms
- [ ] All E2E tests pass
- [ ] Performance acceptable with 8+ connected platforms

---

## Files to Create

### TikTok (ORB-051)

- `src/lib/social/clients/tiktok.ts` (~800 lines)
- `src/lib/social/clients/tiktok.test.ts` (~400 lines)
- `src/app/api/social/tiktok/connect/route.ts` (~110 lines)
- `src/app/api/social/tiktok/callback/route.ts` (~280 lines)
- `src/lib/inbox/collectors/tiktok-collector.ts` (~200 lines)
- `src/lib/inbox/collectors/tiktok-collector.test.ts` (~150 lines)

### Pinterest (ORB-052)

- `src/lib/social/clients/pinterest.ts` (~750 lines)
- `src/lib/social/clients/pinterest.test.ts` (~400 lines)
- `src/app/api/social/pinterest/connect/route.ts` (~100 lines)
- `src/app/api/social/pinterest/callback/route.ts` (~250 lines)
- `src/lib/inbox/collectors/pinterest-collector.ts` (~180 lines)
- `src/lib/inbox/collectors/pinterest-collector.test.ts` (~120 lines)

### YouTube (ORB-053)

- `src/app/api/social/youtube/connect/route.ts` (~100 lines)
- `src/app/api/social/youtube/callback/route.ts` (~270 lines)
- `src/lib/inbox/collectors/youtube-collector.ts` (~200 lines)
- `src/lib/inbox/collectors/youtube-collector.test.ts` (~150 lines)

### Snapchat (ORB-054)

- `src/lib/social/clients/snapchat.ts` (~600 lines)
- `src/lib/social/clients/snapchat.test.ts` (~350 lines)
- `src/app/api/social/snapchat/connect/route.ts` (~100 lines)
- `src/app/api/social/snapchat/callback/route.ts` (~250 lines)

### Database

- `prisma/migrations/20260130_add_pinterest_snapchat/migration.sql`

### Documentation

- `docs/ENVIRONMENT_VARIABLES.md` (or update existing docs)

### Tests

- `e2e/features/orbit-platforms.feature`
- `e2e/step-definitions/orbit-platforms.steps.ts`

**Total New Files:** ~30 files, ~6,000 lines of code

---

## Files to Modify

### Core Integration Files

- `src/lib/social/index.ts` (lines 59-60, 104-105) - Remove stubs, add new platforms
- `src/lib/social/types.ts` (line 512-523) - Update PLATFORM_CAPABILITIES
- `src/lib/constants/social-platforms.ts` (line 13-21) - Add PINTEREST, SNAPCHAT
- `src/lib/inbox/collectors/index.ts` - Export new collectors
- `src/lib/inbox/collection-job.ts` - Add new platforms to collector map

### Database Schema

- `prisma/schema.prisma` (line ~2298) - Add PINTEREST, SNAPCHAT to enum

### UI Components

- `src/components/orbit/connections/ConnectionPlatformIcons.tsx` - Add platform icons
- `src/app/orbit/[workspaceSlug]/settings/accounts/SocialAccountsClient.tsx` - Add connect buttons
- `src/app/orbit/[workspaceSlug]/brand-brain/rewriter/components/PlatformSelector.tsx` - Add platforms
- `src/components/streams/StreamFilters.tsx` - Ensure new platforms show in filters

### Documentation

- `docs/API_REFERENCE.md` - Add OAuth endpoint documentation
- `docs/FEATURES.md` - Update platform support list
- `README.md` - Update platform overview

---

## Success Metrics

### Functional Metrics

- **Platform Coverage:** 8 platforms supported (Twitter, LinkedIn, Facebook, Instagram, TikTok, YouTube, Pinterest, Snapchat)
- **Test Coverage:** 100% unit test coverage for all new client files
- **OAuth Success Rate:** >95% successful OAuth connections
- **API Uptime:** >99.5% availability for OAuth routes

### User Experience Metrics

- **Connection Time:** <30 seconds to connect any platform
- **Stream Load Time:** <2 seconds with 8 platforms connected
- **Error Rate:** <1% OAuth failures (excluding user cancellations)

### Code Quality Metrics

- **Type Safety:** 100% TypeScript strict mode compliance
- **Linting:** 0 ESLint errors
- **Test Coverage:** 100% for new code
- **Documentation:** 100% public methods documented

---

## Post-Implementation Tasks

### Monitoring & Observability

- [ ] Add platform-specific error tracking (Sentry tags)
- [ ] Monitor OAuth success/failure rates
- [ ] Track API rate limit usage per platform
- [ ] Set up alerts for token expiration
- [ ] Monitor video upload success rates (TikTok)

### User Communication

- [ ] Announce new platform support in changelog
- [ ] Create help docs for each platform
- [ ] Add onboarding tooltips for new platforms
- [ ] Send email to users about new integrations

### Future Enhancements

- [ ] Implement video uploads for TikTok (if not in initial release)
- [ ] Add Snapchat Creative Kit for story posting
- [ ] Implement cross-posting workflows
- [ ] Add platform-specific content recommendations
- [ ] Implement unified analytics across all platforms

---

## Notes

### Platform-Specific Considerations

**TikTok:**

- Focus on video content creation - no text-only posts
- Consider integration with video editing tools
- Video processing can take 5-15 minutes
- Emphasize creative features in UI

**Pinterest:**

- Image-centric platform - board organization is key
- Consider auto-creating boards for different content types
- Pin descriptions are important for SEO
- Consider integration with image enhancement tools

**YouTube:**

- Long-form content platform
- Video uploads are complex - consider read-only for MVP
- Focus on analytics and scheduling video metadata
- Channel management vs. video management distinction

**Snapchat:**

- Marketing API vs. Creative Kit decision is critical
- If Marketing API: focus on ad campaigns and analytics
- If Creative Kit: requires mobile integration
- Ephemeral nature of content may limit usefulness

### Code Reuse Opportunities

- OAuth flow logic is very similar across platforms
- Consider creating OAuth helper utilities
- Error handling patterns can be shared
- Type conversion utilities can be generalized

### Future Platform Additions

After these 4 platforms, consider:

- **Threads** (Meta's Twitter alternative)
- **Bluesky** (decentralized social network)
- **Mastodon** (federated social network)
- **Reddit** (community-based platform)
- **Telegram** (messaging platform with channels)

---

## Conclusion

This epic represents a significant expansion of Spike Land's Orbit platform, bringing support from 5 platforms to 8 platforms (9 including Discord). The implementation follows established patterns in the codebase, ensuring consistency and maintainability.

**Key Priorities:**

1. **YouTube first** (quick win, client exists)
2. **TikTok second** (high demand, modern platform)
3. **Pinterest third** (visual platform, good for brands)
4. **Snapchat fourth** (requires API access approval, scope clarification)

**Estimated Total Effort:** 14-19 days

**Risk Level:** Medium (API approvals, video upload complexity)

**Business Impact:** High (comprehensive platform coverage, competitive advantage)

---

_Plan created: 2026-01-29_
_Ready for stakeholder review and approval_
