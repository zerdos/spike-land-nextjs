# Implementation Plan: Real Platform APIs replacing Stubs

**Issue**: #939
**Status**: Ready for Implementation
**Complexity**: Medium
**Estimated Scope**: 2-4 files modified, 1 new file

---

## Summary

Replace the stub/placeholder implementation for TikTok in the social media clients with a real TikTok API integration. Currently, TikTok is listed as a supported platform in the database schema but throws a "not yet implemented" error when attempting to use it.

### Current State Analysis

After exploring the codebase, here's what exists:

**Implemented Platforms (src/lib/social/clients/):**

- ‚úÖ Twitter (`twitter.ts`) - Full OAuth + API implementation
- ‚úÖ Facebook (`facebook.ts`) - Full Graph API implementation
- ‚úÖ Instagram (`instagram.ts`) - Full Graph API implementation (via Facebook)
- ‚úÖ LinkedIn (`linkedin.ts`) - Full OAuth + API implementation
- ‚úÖ YouTube (`youtube.ts`) - Full Google OAuth + Data API v3 implementation
- ‚úÖ Discord (`discord.ts`) - Bot-based implementation (not OAuth)

**Stub Platform:**

- ‚ùå TikTok - Listed in `SocialPlatform` enum but throws error "Platform TIKTOK is not yet implemented" in `src/lib/social/index.ts:60`

### The Issue

The issue mentions "platforms (e.g., YouTube, TikTok, Meta)" but investigation reveals:

- YouTube, Facebook (Meta), and Instagram are **already fully implemented** with real APIs
- Only **TikTok remains as a stub**

---

## Acceptance Criteria Mapping

### ‚úÖ Criterion 1: Identify all current API stubs for platforms

**Status**: Complete via exploration

**Findings**:

- TikTok is the only stub
- All other platforms have full implementations

### üî® Criterion 2: Replace stubs with actual API calls using valid credentials

**Plan**: Implement TikTok API client using TikTok for Developers API

**Required**:

- Create `src/lib/social/clients/tiktok.ts`
- Implement `ISocialClient` interface
- Use OAuth 2.0 flow (similar to Twitter/LinkedIn pattern)
- Store credentials in environment variables

### üî® Criterion 3: Handle rate limiting and authentication errors

**Plan**: Follow existing patterns

**Implementation**:

- Use try-catch blocks around API calls (like other clients)
- Parse TikTok error responses and throw descriptive errors
- Document rate limits in code comments
- Consider implementing retry logic with exponential backoff

### üî® Criterion 4: Ensure data mapping from real API matches the stub interface

**Plan**: Map TikTok responses to `ISocialClient` interface types

**Required Mappings**:

- `getAccountInfo()` ‚Üí `SocialAccountInfo`
- `createPost()` ‚Üí `PostResult`
- `getPosts()` ‚Üí `SocialPost[]`
- `getMetrics()` ‚Üí `SocialMetricsData`

---

## Technical Approach

### TikTok API Overview

**API**: TikTok for Developers - Content Posting API
**Documentation**: https://developers.tiktok.com/doc/content-posting-api-get-started
**OAuth Flow**: OAuth 2.0 with PKCE (same as Twitter)

**Key Endpoints**:

- OAuth: `https://www.tiktok.com/v2/auth/authorize/`
- Token Exchange: `https://open.tiktokapis.com/v2/oauth/token/`
- User Info: `https://open.tiktokapis.com/v2/user/info/`
- Direct Post: `https://open.tiktokapis.com/v2/post/publish/inbox/video/init/`
- Creator Posts: `https://open.tiktokapis.com/v2/post/publish/creator_info/query/`
- Video Query: `https://open.tiktokapis.com/v2/post/publish/video/query/`

**Required Scopes**:

- `user.info.basic` - Get user profile info
- `video.publish` - Publish videos
- `video.list` - List user's videos

**Rate Limits** (from TikTok docs):

- User Info: 100 requests per day
- Direct Post: 4 videos per day per user
- Creator Posts: 100 requests per day
- Video Query: 100 requests per day

---

## Files to Create

### 1. `src/lib/social/clients/tiktok.ts` (NEW)

**Purpose**: TikTok API client implementing `ISocialClient` interface

**Key Implementation Notes**:

- Video upload is a 3-step process: init ‚Üí upload ‚Üí publish
- Content must be video format (MP4 recommended)
- Requires `TIKTOK_CLIENT_KEY` and `TIKTOK_CLIENT_SECRET` env vars

### 2. `src/lib/social/clients/tiktok.test.ts` (NEW)

**Purpose**: Unit tests for TikTok client

---

## Files to Modify

### 1. `src/lib/social/index.ts`

**Line 59-60** - Replace throw with TikTokClient import
**Line 104-105** - Replace throw with TikTokClient import

### 2. `.env.example`

Add TikTok credentials section with setup instructions

---

## Environment Variables Required

```bash
TIKTOK_CLIENT_KEY=<your-client-key>
TIKTOK_CLIENT_SECRET=<your-client-secret>
```

---

## Testing Considerations

### Unit Tests

- Mock TikTok API responses
- Test OAuth flow
- Test data mapping
- Test error handling
- Verify environment variable validation

### Edge Cases

- ‚ùå User tries to upload image (TikTok only supports video)
- ‚ùå Video exceeds size limit
- ‚ùå Daily upload quota exceeded (4 videos/day)
- ‚ùå Rate limit hit (100 API calls/day)
- ‚ùå OAuth token expired

---

## Potential Risks & Blockers

### üî¥ High Priority

1. **TikTok App Approval Required for Production**
   - Sandbox mode available for testing
   - Manual review needed for production access

2. **Video Upload Complexity**
   - 3-step process (init ‚Üí upload ‚Üí publish)
   - Large files may timeout

3. **Strict Rate Limits**
   - Only 4 uploads per day per user
   - 100 API calls per day for queries

---

## Out of Scope

‚ùå Creating new platform integrations not currently stubbed
‚ùå Implementing TikTok features beyond basic OAuth + content posting
‚ùå Building video encoding/transcoding pipeline

---

## Implementation Checklist

### Phase 1: Core Implementation

- [ ] Create `src/lib/social/clients/tiktok.ts`
- [ ] Implement OAuth methods
- [ ] Implement getAccountInfo()
- [ ] Implement createPost()
- [ ] Implement getPosts()
- [ ] Implement getMetrics()

### Phase 2: Integration

- [ ] Update `src/lib/social/index.ts`
- [ ] Add environment variables to `.env.example`
- [ ] Test OAuth flow end-to-end

### Phase 3: Testing

- [ ] Create unit tests
- [ ] Test error handling
- [ ] Verify 100% code coverage

### Phase 4: Documentation

- [ ] Document rate limits
- [ ] Update API reference
- [ ] Add setup instructions

---

## Success Metrics

1. ‚úÖ TikTok OAuth flow works end-to-end
2. ‚úÖ Users can connect TikTok accounts
3. ‚úÖ `createSocialClient("TIKTOK")` returns working client
4. ‚úÖ Video uploads succeed
5. ‚úÖ All tests pass with 100% coverage
6. ‚úÖ Rate limiting handled gracefully

---

**Plan Author**: Claude Sonnet 4.5 (Ralph Wiggum Planning Agent)
**Date**: 2026-01-29
