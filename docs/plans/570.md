# Implementation Plan: #570 - Create Feedback Loop Analytics

**Issue**: [#570](https://github.com/zerdos/spike-land-nextjs/issues/570)
**Parent Epic**: [#521 - Content-to-Ads Loop](https://github.com/zerdos/spike-land-nextjs/issues/521)
**Complexity**: **Complex**
**Estimated Changes**: ~15 new files, 8 modified files, new database tables

---

## Summary

Implement a comprehensive feedback loop analytics system that measures the effectiveness of boosting organic content to paid ads. This system will compare organic vs paid performance, provide ML-based optimization recommendations, and deliver actionable insights through a learning dashboard. The feature enables data-driven decisions about which content to boost, when to boost it, and how to target it for maximum ROI.

---

## Current State Analysis

### Existing Infrastructure ✅

The platform already has:

1. **Campaign Tracking System**
   - `allocator_campaigns` table with platform campaign IDs and metrics
   - `campaign_attributions` table for conversion tracking
   - `campaign_metrics_cache` for performance data
   - `campaign_links` for UTM tracking
   - Files: `src/lib/allocator/allocator-types.ts`, `src/lib/allocator/allocator-service.ts`

2. **Social Media Analytics**
   - `social_metrics` table tracking followers, engagement, reach
   - `social_posts` table with scheduled and published posts
   - `SocialPostAbTest` and variants for A/B testing
   - Files: `packages/shared/src/types/social-api-responses.ts`

3. **Analytics Foundation**
   - `analytics_events` table for event tracking
   - Vercel Analytics integration
   - Files: `src/lib/analytics.ts`, `src/lib/reports/vercel-analytics-client.ts`

4. **Allocator AI Agent**
   - Performance analysis and budget recommendations
   - ROAS, CPA, CTR metrics tracking
   - Trend analysis (improving/stable/declining)
   - Files: `src/lib/allocator/allocator-types.ts:34-69`

### Current Gaps ❌

Missing infrastructure needed:

1. **Boost Tracking** - No linkage between organic posts and their boosted ad campaigns
2. **Attribution Model** - No separation of organic vs paid contribution to results
3. **ML Optimization** - No predictive model for boost timing and targeting
4. **Learning Dashboard** - No UI for visualizing boost effectiveness patterns
5. **Feedback Pipeline** - No data aggregation for ML training dataset

---

## Architecture Overview

### Data Flow

```
┌─────────────────┐
│  Organic Post   │
│  (social_posts) │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Boost Decision  │
│  (User/AI)      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐      ┌──────────────────┐
│  Boosted Ad     │─────▶│  Campaign Metrics│
│  (campaigns)    │      │  (ad performance)│
└────────┬────────┘      └─────────┬────────┘
         │                          │
         │                          │
         ▼                          ▼
┌─────────────────────────────────────┐
│    Attribution Model                │
│  (separates organic vs paid impact) │
└────────────────┬────────────────────┘
                 │
                 ▼
┌──────────────────────────────────────┐
│     Boost Analytics Service          │
│  - Effectiveness metrics             │
│  - Organic vs paid comparison        │
│  - ROI analysis                      │
└────────────┬─────────────────────────┘
             │
             ▼
┌──────────────────────────────────────┐
│      ML Optimization Engine          │
│  - Predict best boost timing         │
│  - Recommend targeting               │
│  - Generate insights                 │
└────────────┬─────────────────────────┘
             │
             ▼
┌──────────────────────────────────────┐
│       Learning Dashboard             │
│  - Visual insights                   │
│  - Best practices                    │
│  - Automated recommendations         │
└──────────────────────────────────────┘
```

---

## Database Schema Changes

### New Tables

#### 1. `boost_campaigns`

Links organic posts to their boosted campaigns with boost decision metadata.

```prisma
model BoostCampaign {
  id                    String   @id @default(cuid())
  workspaceId           String
  workspace             Workspace @relation(fields: [workspaceId], references: [id])

  // Source organic content
  originalPostId        String?
  originalPost          SocialPost? @relation(fields: [originalPostId], references: [id])

  // Linked campaign
  campaignId            String
  campaign              AllocatorCampaign @relation(fields: [campaignId], references: [id])

  // Boost decision metadata
  boostedAt             DateTime
  boostedBy             String   // userId or "AI_AGENT"
  boostReason           String   // Why was this boosted?
  boostStrategy         String   // e.g., "HIGH_ENGAGEMENT", "VIRAL_POTENTIAL"

  // Pre-boost organic metrics (snapshot)
  organicMetrics        Json     // { impressions, engagement, reach, likes, comments, shares }

  // Boost configuration
  targetingCriteria     Json?    // { demographics, interests, locations }
  initialBudget         Int      // in cents
  duration              Int      // in days

  // Status
  status                BoostStatus @default(ACTIVE)

  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("boost_campaigns")
  @@index([workspaceId])
  @@index([originalPostId])
  @@index([campaignId])
  @@index([boostedAt])
}

enum BoostStatus {
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}
```

#### 2. `boost_performance_snapshots`

Time-series data capturing boost performance at regular intervals.

```prisma
model BoostPerformanceSnapshot {
  id                    String   @id @default(cuid())
  boostCampaignId       String
  boostCampaign         BoostCampaign @relation(fields: [boostCampaignId], references: [id], onDelete: Cascade)

  // Snapshot timestamp
  snapshotAt            DateTime
  daysSinceBoosted      Int      // Days elapsed since boost started

  // Organic metrics (continued organic performance)
  organicImpressions    Int
  organicEngagements    Int
  organicReach          Int

  // Paid metrics (from campaign)
  paidImpressions       Int
  paidClicks            Int
  paidConversions       Int
  paidSpend             Int      // in cents
  paidCtr               Float    // click-through rate
  paidCpa               Float    // cost per acquisition
  paidRoas              Float    // return on ad spend

  // Attribution metrics
  attributedOrganic     Int      // Conversions attributed to organic
  attributedPaid        Int      // Conversions attributed to paid
  attributedOverlap     Int      // Conversions with both touchpoints

  // Computed metrics
  incrementalReach      Int      // Paid reach - organic reach overlap
  costPerResult         Float    // paidSpend / (paidConversions + attributedOverlap)
  totalRoi              Float    // (total value - cost) / cost

  createdAt             DateTime @default(now())

  @@map("boost_performance_snapshots")
  @@index([boostCampaignId, snapshotAt])
  @@index([snapshotAt])
}
```

#### 3. `boost_attribution_events`

Granular attribution tracking for individual user interactions.

```prisma
model BoostAttributionEvent {
  id                    String   @id @default(cuid())
  boostCampaignId       String
  boostCampaign         BoostCampaign @relation(fields: [boostCampaignId], references: [id], onDelete: Cascade)

  // User/session tracking
  sessionId             String?
  userId                String?

  // Interaction details
  eventType             AttributionEventType
  touchpointType        TouchpointType  // ORGANIC or PAID
  platform              String          // e.g., "FACEBOOK", "INSTAGRAM"

  // Event metadata
  eventValue            Int?            // in cents, for conversion events
  eventMetadata         Json?           // platform-specific data

  // Timestamp
  occurredAt            DateTime

  createdAt             DateTime @default(now())

  @@map("boost_attribution_events")
  @@index([boostCampaignId, occurredAt])
  @@index([sessionId])
  @@index([userId])
}

enum AttributionEventType {
  VIEW
  CLICK
  ENGAGEMENT
  CONVERSION
  SHARE
}

enum TouchpointType {
  ORGANIC
  PAID
  UNKNOWN
}
```

#### 4. `boost_ml_training_data`

Aggregated data for ML model training.

```prisma
model BoostMlTrainingData {
  id                    String   @id @default(cuid())
  workspaceId           String
  workspace             Workspace @relation(fields: [workspaceId], references: [id])

  boostCampaignId       String   @unique
  boostCampaign         BoostCampaign @relation(fields: [boostCampaignId], references: [id], onDelete: Cascade)

  // Features (inputs)
  features              Json     // All input features for ML model

  // Labels (outcomes)
  labels                Json     // Target variables (success metrics)

  // Training metadata
  dataQualityScore      Float    // 0-1 score for data completeness
  isTrainingReady       Boolean  @default(false)

  aggregatedAt          DateTime
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("boost_ml_training_data")
  @@index([workspaceId, isTrainingReady])
  @@index([aggregatedAt])
}
```

#### 5. `boost_recommendations`

ML-generated recommendations for future boosts.

```prisma
model BoostRecommendation {
  id                    String   @id @default(cuid())
  workspaceId           String
  workspace             Workspace @relation(fields: [workspaceId], references: [id])

  // Recommendation target
  suggestedPostId       String?
  suggestedPost         SocialPost? @relation(fields: [suggestedPostId], references: [id])

  // Recommendation details
  recommendationType    RecommendationType
  confidence            Float    // 0-1 confidence score
  priority              Int      // 1-5 priority ranking

  // Boost parameters
  suggestedBudget       Int      // in cents
  suggestedDuration     Int      // in days
  suggestedTiming       DateTime // Best time to boost
  suggestedTargeting    Json     // Targeting recommendations

  // Projected impact
  projectedReach        Int
  projectedConversions  Int
  projectedRoi          Float
  confidenceInterval    Json     // { low, high } bounds

  // Reasoning
  reason                String   @db.Text
  supportingData        Json     // Supporting metrics and insights

  // Status
  status                RecommendationStatus @default(PENDING)
  appliedAt             DateTime?
  resultingBoostId      String?  // Link to boost if recommendation was applied

  createdAt             DateTime @default(now())
  expiresAt             DateTime

  @@map("boost_recommendations")
  @@index([workspaceId, status])
  @@index([confidence])
  @@index([createdAt])
}

enum RecommendationType {
  BOOST_HIGH_PERFORMER
  BOOST_TRENDING
  OPTIMIZE_TARGETING
  INCREASE_BUDGET
  ADJUST_TIMING
  REPLICATE_SUCCESS
}

enum RecommendationStatus {
  PENDING
  APPLIED
  DISMISSED
  EXPIRED
}
```

#### 6. `boost_insights`

Dashboard insights and best practices derived from historical data.

```prisma
model BoostInsight {
  id                    String   @id @default(cuid())
  workspaceId           String
  workspace             Workspace @relation(fields: [workspaceId], references: [id])

  // Insight metadata
  insightType           InsightType
  category              InsightCategory
  severity              InsightSeverity // How important is this insight?

  // Insight content
  title                 String
  description           String   @db.Text
  visualization         Json?    // Chart/graph data for dashboard

  // Supporting data
  dataPoints            Json     // Raw data supporting the insight
  comparisonMetrics     Json?    // Before/after or benchmark comparisons

  // Actionability
  actionable            Boolean  @default(true)
  suggestedActions      Json?    // Array of recommended actions

  // Time period
  periodStart           DateTime
  periodEnd             DateTime

  // Status
  acknowledged          Boolean  @default(false)
  acknowledgedBy        String?
  acknowledgedAt        DateTime?

  createdAt             DateTime @default(now())

  @@map("boost_insights")
  @@index([workspaceId, acknowledged])
  @@index([severity, acknowledged])
  @@index([createdAt])
}

enum InsightType {
  PATTERN
  ANOMALY
  BEST_PRACTICE
  WARNING
  OPPORTUNITY
}

enum InsightCategory {
  TIMING
  TARGETING
  BUDGET
  CONTENT_TYPE
  PLATFORM
  AUDIENCE
}

enum InsightSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}
```

---

## Implementation Steps

### Phase 1: Database Foundation (Week 1)

#### Step 1.1: Create Prisma Schema Migration

**Files to Create**:

- `prisma/migrations/YYYYMMDDHHMMSS_add_boost_analytics/migration.sql`

**Actions**:

1. Add all 6 new models to `prisma/schema.prisma`
2. Add enums: `BoostStatus`, `AttributionEventType`, `TouchpointType`, `RecommendationType`, `RecommendationStatus`, `InsightType`, `InsightCategory`, `InsightSeverity`
3. Add relations to existing models:
   - `Workspace.boostCampaigns`
   - `Workspace.boostRecommendations`
   - `Workspace.boostInsights`
   - `SocialPost.boostCampaigns`
   - `SocialPost.boostRecommendations`
   - `AllocatorCampaign.boostCampaign`
4. Generate migration: `yarn prisma migrate dev --name add_boost_analytics`
5. Update `docs/DATABASE_SCHEMA.md` with new tables

#### Step 1.2: Create TypeScript Types

**Files to Create**:

- `packages/shared/src/types/boost-analytics.ts`

**Content**:

```typescript
export interface BoostCampaignData {
  id: string;
  workspaceId: string;
  originalPostId: string | null;
  campaignId: string;
  boostedAt: Date;
  boostedBy: string;
  boostReason: string;
  boostStrategy: string;
  organicMetrics: OrganicMetricsSnapshot;
  targetingCriteria: TargetingCriteria | null;
  initialBudget: number;
  duration: number;
  status: BoostStatus;
}

export interface OrganicMetricsSnapshot {
  impressions: number;
  engagement: number;
  reach: number;
  likes: number;
  comments: number;
  shares: number;
  capturedAt: Date;
}

export interface TargetingCriteria {
  demographics?: {
    ageMin?: number;
    ageMax?: number;
    genders?: string[];
    languages?: string[];
  };
  interests?: string[];
  locations?: {
    countries?: string[];
    regions?: string[];
    cities?: string[];
  };
  behaviors?: string[];
  customAudiences?: string[];
}

export interface BoostPerformanceMetrics {
  organic: {
    impressions: number;
    engagements: number;
    reach: number;
  };
  paid: {
    impressions: number;
    clicks: number;
    conversions: number;
    spend: number;
    ctr: number;
    cpa: number;
    roas: number;
  };
  attribution: {
    organic: number;
    paid: number;
    overlap: number;
  };
  computed: {
    incrementalReach: number;
    costPerResult: number;
    totalRoi: number;
  };
}

export interface BoostEffectivenessAnalysis {
  boostCampaignId: string;
  overallScore: number; // 0-100
  metrics: BoostPerformanceMetrics;
  comparison: {
    organicOnlyProjected: number; // What would have happened without boost?
    actualWithBoost: number;
    lift: number; // % improvement
  };
  costEfficiency: {
    costPerIncremental: number;
    organicVsPaidCostRatio: number;
  };
  recommendations: string[];
}

// ... additional types
```

---

### Phase 2: Boost Tracking Service (Week 1-2)

#### Step 2.1: Create Boost Campaign Service

**Files to Create**:

- `src/lib/boost-analytics/boost-campaign-service.ts`
- `src/lib/boost-analytics/boost-campaign-service.test.ts`

**Responsibilities**:

- Create boost campaign records when organic content is boosted
- Link organic posts to ad campaigns
- Capture pre-boost organic metrics snapshot
- Track boost configuration and targeting

**Key Methods**:

```typescript
class BoostCampaignService {
  async createBoostCampaign(params: CreateBoostParams): Promise<BoostCampaign>;
  async getBoostCampaign(id: string): Promise<BoostCampaign | null>;
  async listBoostCampaigns(workspaceId: string, filters?: BoostFilters): Promise<BoostCampaign[]>;
  async updateBoostStatus(id: string, status: BoostStatus): Promise<void>;
  async linkCampaignToBoost(boostId: string, campaignId: string): Promise<void>;
}
```

#### Step 2.2: Create Performance Snapshot Service

**Files to Create**:

- `src/lib/boost-analytics/snapshot-service.ts`
- `src/lib/boost-analytics/snapshot-service.test.ts`

**Responsibilities**:

- Collect performance snapshots at regular intervals (hourly/daily)
- Aggregate organic and paid metrics
- Calculate computed metrics (incremental reach, ROI, etc.)
- Store time-series data for trend analysis

**Integration Points**:

- Fetch organic metrics from `social_metrics` table
- Fetch paid metrics from `allocator_campaigns` and campaign APIs
- Run as scheduled job (cron or background worker)

---

### Phase 3: Attribution Model (Week 2-3)

#### Step 3.1: Create Attribution Service

**Files to Create**:

- `src/lib/boost-analytics/attribution-service.ts`
- `src/lib/boost-analytics/attribution-service.test.ts`
- `src/lib/boost-analytics/attribution-models/linear-attribution.ts`
- `src/lib/boost-analytics/attribution-models/time-decay-attribution.ts`
- `src/lib/boost-analytics/attribution-models/position-based-attribution.ts`

**Responsibilities**:

- Track user touchpoints (organic and paid)
- Attribute conversions to appropriate source
- Handle multi-touch attribution scenarios
- Calculate organic vs paid contribution

**Attribution Models to Implement**:

1. **Linear Attribution**: Equal credit to all touchpoints
2. **Time Decay**: More credit to recent touchpoints
3. **Position-Based**: More credit to first and last touchpoints
4. **Custom**: ML-based dynamic attribution (Phase 4)

**Key Methods**:

```typescript
class AttributionService {
  async trackAttributionEvent(event: AttributionEventInput): Promise<void>;
  async calculateAttribution(boostId: string, model: AttributionModel): Promise<AttributionResult>;
  async getAttributionReport(boostId: string): Promise<AttributionReport>;
}
```

#### Step 3.2: Integrate with Campaign Tracking

**Files to Modify**:

- `src/lib/allocator/allocator-service.ts` - Add boost attribution tracking
- `src/app/api/orbit/campaigns/route.ts` - Add attribution endpoints

**Actions**:

1. Add boost campaign ID to conversion tracking
2. Link `campaign_attributions` to `boost_attribution_events`
3. Update UTM parameter generation to include boost identifiers

---

### Phase 4: Analytics & Insights Engine (Week 3-4)

#### Step 4.1: Create Boost Analytics Service

**Files to Create**:

- `src/lib/boost-analytics/analytics-service.ts`
- `src/lib/boost-analytics/analytics-service.test.ts`
- `src/lib/boost-analytics/metrics/effectiveness-calculator.ts`
- `src/lib/boost-analytics/metrics/comparison-engine.ts`
- `src/lib/boost-analytics/metrics/roi-calculator.ts`

**Responsibilities**:

- Calculate boost effectiveness metrics
- Compare organic vs paid performance
- Analyze cost per result across campaigns
- Generate performance comparisons

**Key Metrics to Calculate**:

1. **Boost Effectiveness Score** (0-100):
   - Weighted combination of reach lift, engagement lift, conversion lift, ROI
2. **Incremental Lift**: Performance gain beyond organic baseline
3. **Cost Efficiency**: Cost per incremental result
4. **ROI**: (Revenue - Cost) / Cost
5. **Organic vs Paid Split**: Attribution breakdown

#### Step 4.2: Create Insights Generator

**Files to Create**:

- `src/lib/boost-analytics/insights/insight-generator.ts`
- `src/lib/boost-analytics/insights/insight-generator.test.ts`
- `src/lib/boost-analytics/insights/pattern-detector.ts`
- `src/lib/boost-analytics/insights/best-practices-analyzer.ts`

**Responsibilities**:

- Detect patterns in boost performance data
- Identify best practices (optimal timing, targeting, budgets)
- Generate actionable insights for dashboard
- Flag warnings and opportunities

**Insight Types to Generate**:

1. **Timing Insights**: Best days/times to boost
2. **Targeting Insights**: Most effective audience segments
3. **Budget Insights**: Optimal budget allocation
4. **Content Insights**: Which content types perform best when boosted
5. **Platform Insights**: Platform-specific performance patterns

---

### Phase 5: ML Optimization Engine (Week 4-5)

#### Step 5.1: Create ML Training Data Pipeline

**Files to Create**:

- `src/lib/boost-analytics/ml/training-data-aggregator.ts`
- `src/lib/boost-analytics/ml/training-data-aggregator.test.ts`
- `src/lib/boost-analytics/ml/feature-engineering.ts`

**Responsibilities**:

- Aggregate historical boost performance data
- Engineer features for ML models
- Create training dataset with labels
- Ensure data quality and completeness

**Features to Engineer**:

- Content features: type, length, sentiment, media count
- Timing features: day of week, hour, seasonality
- Audience features: demographics, engagement history
- Historical features: past boost performance, account metrics
- Context features: industry trends, competitor activity

**Labels (Target Variables)**:

- Conversion rate
- ROI
- Engagement lift
- Cost per result

#### Step 5.2: Create ML Recommendation Service

**Files to Create**:

- `src/lib/boost-analytics/ml/recommendation-engine.ts`
- `src/lib/boost-analytics/ml/recommendation-engine.test.ts`
- `src/lib/boost-analytics/ml/models/boost-timing-predictor.ts`
- `src/lib/boost-analytics/ml/models/targeting-optimizer.ts`
- `src/lib/boost-analytics/ml/models/budget-optimizer.ts`

**Responsibilities**:

- Predict optimal boost timing for new content
- Recommend targeting parameters
- Suggest budget allocation
- Generate confidence scores for recommendations

**ML Approach** (Initial Implementation):

1. **Rule-Based System** (MVP): Use statistical analysis and heuristics
   - Analyze historical data for patterns
   - Apply simple decision rules
   - Generate recommendations with confidence scores

2. **Future Enhancement** (Post-MVP):
   - Integrate with external ML service (e.g., TensorFlow.js, AWS SageMaker)
   - Train predictive models on aggregated data
   - Implement reinforcement learning for continuous optimization

**Key Methods**:

```typescript
class MLRecommendationEngine {
  async generateRecommendations(workspaceId: string): Promise<BoostRecommendation[]>;
  async predictBoostOutcome(params: BoostParams): Promise<PredictedOutcome>;
  async optimizeTargeting(boostId: string): Promise<TargetingRecommendation>;
  async suggestBudget(postId: string): Promise<BudgetRecommendation>;
}
```

#### Step 5.3: Create Automated Recommendations System

**Files to Create**:

- `src/lib/boost-analytics/automation/recommendation-scheduler.ts`
- `src/lib/boost-analytics/automation/recommendation-scheduler.test.ts`

**Responsibilities**:

- Periodically generate recommendations for all workspaces
- Prioritize recommendations by confidence and potential impact
- Store recommendations in database
- Send notifications for high-priority recommendations

**Integration**:

- Run as scheduled job (e.g., daily at 9 AM workspace timezone)
- Integrate with notification system for alerts
- Provide API endpoints for fetching recommendations

---

### Phase 6: Learning Dashboard UI (Week 5-6)

#### Step 6.1: Create Dashboard Backend API

**Files to Create**:

- `src/app/api/orbit/boost-analytics/route.ts`
- `src/app/api/orbit/boost-analytics/[id]/route.ts`
- `src/app/api/orbit/boost-analytics/insights/route.ts`
- `src/app/api/orbit/boost-analytics/recommendations/route.ts`

**Endpoints**:

```typescript
GET /api/orbit/boost-analytics
  - List all boost campaigns for workspace
  - Query params: status, dateRange, sortBy

GET /api/orbit/boost-analytics/:id
  - Get detailed boost campaign data
  - Includes performance metrics and attribution

GET /api/orbit/boost-analytics/insights
  - Get insights for workspace
  - Query params: category, severity, acknowledged

GET /api/orbit/boost-analytics/recommendations
  - Get ML recommendations
  - Query params: status, confidence, sortBy

POST /api/orbit/boost-analytics/recommendations/:id/apply
  - Apply a recommendation (create boost campaign)

POST /api/orbit/boost-analytics/insights/:id/acknowledge
  - Mark insight as acknowledged
```

#### Step 6.2: Create Dashboard Frontend Components

**Files to Create**:

- `src/app/(dashboard)/orbit/boost-analytics/page.tsx` - Main dashboard
- `src/app/(dashboard)/orbit/boost-analytics/[id]/page.tsx` - Boost detail view
- `src/components/orbit/boost-analytics/dashboard-overview.tsx`
- `src/components/orbit/boost-analytics/effectiveness-chart.tsx`
- `src/components/orbit/boost-analytics/organic-vs-paid-comparison.tsx`
- `src/components/orbit/boost-analytics/insights-panel.tsx`
- `src/components/orbit/boost-analytics/recommendations-list.tsx`
- `src/components/orbit/boost-analytics/attribution-visualization.tsx`
- `src/components/orbit/boost-analytics/best-practices-panel.tsx`

**Dashboard Sections**:

1. **Overview Panel**:
   - Total boosts created
   - Average ROI
   - Total incremental conversions
   - Cost savings vs organic-only

2. **Effectiveness Metrics**:
   - Boost performance scorecard
   - Cost per result comparison table
   - Time-series charts of key metrics

3. **Organic vs Paid Comparison**:
   - Side-by-side metric comparison
   - Attribution breakdown (stacked bar chart)
   - Overlap analysis (Venn diagram)

4. **Insights & Best Practices**:
   - Actionable insights cards
   - Pattern highlights
   - Warning flags
   - Opportunity callouts

5. **Recommendations**:
   - AI-generated boost suggestions
   - Confidence scores
   - Projected impact
   - One-click apply actions

6. **Attribution Visualization**:
   - User journey flowchart
   - Multi-touch attribution sunburst
   - Conversion path analysis

**Design System**:

- Use existing shadcn/ui components
- Follow Tailwind CSS patterns in codebase
- Ensure responsive design
- Add loading states and error boundaries

#### Step 6.3: Create Interactive Charts

**Dependencies**:

- Install: `recharts` or `visx` for React charts
- Use existing analytics patterns from `src/lib/reports/`

**Chart Types**:

1. Line charts: Performance trends over time
2. Bar charts: Metric comparisons
3. Pie charts: Attribution split
4. Area charts: Stacked organic + paid metrics
5. Scatter plots: Budget vs ROI correlation

---

### Phase 7: A/B Testing Framework (Week 6-7)

#### Step 7.1: Extend Existing A/B Testing

**Files to Modify**:

- Leverage existing `SocialPostAbTest` and `SocialPostAbTestVariant` models
- `src/lib/social/ab-test-service.ts` (create if doesn't exist)

**New Features**:

- Test different boost strategies (targeting, budgets, timing)
- Compare boost variants side-by-side
- Statistical significance testing
- Winner selection based on performance

#### Step 7.2: Create Boost Strategy Tester

**Files to Create**:

- `src/lib/boost-analytics/testing/strategy-tester.ts`
- `src/lib/boost-analytics/testing/strategy-tester.test.ts`
- `src/lib/boost-analytics/testing/significance-calculator.ts`

**Responsibilities**:

- Create A/B test for boost strategies
- Track performance of each variant
- Calculate statistical significance
- Recommend winning strategy

**Test Scenarios**:

1. **Timing Test**: Morning vs Evening boost start times
2. **Budget Test**: Different budget levels ($50 vs $100 vs $200)
3. **Targeting Test**: Broad vs Narrow audience targeting
4. **Platform Test**: Facebook vs Instagram vs Multi-platform
5. **Creative Test**: Different ad formats or copy variations

---

### Phase 8: Background Jobs & Automation (Week 7)

#### Step 8.1: Create Scheduled Jobs

**Files to Create**:

- `src/lib/boost-analytics/jobs/snapshot-collector.ts`
- `src/lib/boost-analytics/jobs/insight-generator.ts`
- `src/lib/boost-analytics/jobs/recommendation-generator.ts`
- `src/lib/boost-analytics/jobs/training-data-aggregator.ts`

**Job Schedule**:

```typescript
// Hourly: Collect performance snapshots
cron.schedule("0 * * * *", async () => {
  await snapshotCollector.collectAllActiveBoosts();
});

// Daily: Generate insights and recommendations
cron.schedule("0 9 * * *", async () => {
  await insightGenerator.generateDailyInsights();
  await recommendationGenerator.generateRecommendations();
});

// Weekly: Aggregate training data
cron.schedule("0 2 * * 0", async () => {
  await trainingDataAggregator.aggregateWeeklyData();
});
```

**Integration Options**:

1. **Vercel Cron** (if on paid plan) - Use `vercel.json` cron configuration
2. **GitHub Actions** - Scheduled workflows calling API endpoints
3. **External Scheduler** - AWS EventBridge, Cloudflare Workers Cron
4. **Manual Trigger** - API endpoints for on-demand execution

#### Step 8.2: Create API Endpoints for Jobs

**Files to Create**:

- `src/app/api/orbit/boost-analytics/jobs/snapshot/route.ts`
- `src/app/api/orbit/boost-analytics/jobs/insights/route.ts`
- `src/app/api/orbit/boost-analytics/jobs/recommendations/route.ts`

**Endpoints**:

```typescript
POST /api/orbit/boost-analytics/jobs/snapshot
  - Manually trigger snapshot collection
  - Protected by admin auth

POST /api/orbit/boost-analytics/jobs/insights
  - Manually trigger insight generation

POST /api/orbit/boost-analytics/jobs/recommendations
  - Manually trigger recommendation generation
```

---

## Testing Strategy

### Unit Tests (100% Coverage Required)

**Service Layer Tests**:

- `boost-campaign-service.test.ts`: CRUD operations, error handling
- `snapshot-service.test.ts`: Metric calculations, time-series logic
- `attribution-service.test.ts`: Attribution models, multi-touch scenarios
- `analytics-service.test.ts`: Effectiveness calculations, ROI formulas
- `insight-generator.test.ts`: Pattern detection, insight generation
- `recommendation-engine.test.ts`: Recommendation logic, confidence scoring

**Model Tests**:

- Test all attribution models with known inputs/outputs
- Validate metric calculations against manual calculations
- Test edge cases (zero spend, negative ROI, missing data)

### Integration Tests

**Database Tests**:

- Test Prisma queries and relations
- Verify cascade deletes work correctly
- Test transaction rollbacks

**API Tests**:

- Test all endpoints with valid/invalid inputs
- Test authentication and authorization
- Test rate limiting and error responses

### E2E Tests (Cucumber/Playwright)

**Feature Files to Create**:

- `e2e/features/orbit-boost-analytics.feature`

**Scenarios**:

```gherkin
Feature: Boost Analytics Dashboard

  Scenario: View boost campaign effectiveness
    Given I am logged in as a workspace admin
    And I have boosted 3 organic posts to ads
    When I navigate to the boost analytics dashboard
    Then I should see effectiveness metrics for all 3 campaigns
    And I should see organic vs paid comparison charts
    And I should see ROI calculations

  Scenario: Apply AI recommendation
    Given I am on the boost analytics dashboard
    And there is a high-confidence recommendation to boost a post
    When I click "Apply Recommendation"
    Then a new boost campaign should be created
    And the recommendation status should change to "Applied"
    And I should see the new campaign in my active boosts

  Scenario: View attribution breakdown
    Given I have a boost campaign with conversions
    When I view the campaign detail page
    Then I should see the attribution split (organic vs paid)
    And I should see individual user journey paths
    And I should see multi-touch attribution analysis
```

---

## API Documentation Updates

**Files to Modify**:

- `docs/API_REFERENCE.md` - Add boost analytics endpoints
- `docs/API_CHANGELOG.md` - Document new API version

**New API Sections**:

1. Boost Analytics Overview
2. Boost Campaign Management
3. Performance Snapshots
4. Attribution Tracking
5. Insights & Recommendations
6. Dashboard Data Endpoints

---

## Security Considerations

### Authentication & Authorization

- All boost analytics endpoints require workspace membership
- Admin role required for applying recommendations automatically
- Workspace owners can view/manage all boost campaigns
- Team members can view based on workspace permissions

### Data Privacy

- Attribution events must not expose individual user identities
- Aggregate metrics only (no PII in snapshots)
- Comply with GDPR/CCPA for tracking and analytics
- Allow users to opt-out of tracking if required

### Rate Limiting

- Prevent abuse of ML recommendation generation
- Limit snapshot collection frequency per workspace
- Throttle insight generation to avoid resource exhaustion

---

## Performance Considerations

### Database Optimization

- Add indexes on frequently queried columns (see schema)
- Partition `boost_performance_snapshots` table by date
- Archive old data (>90 days) to separate table
- Use database views for complex queries

### Caching Strategy

- Cache boost effectiveness calculations (5-minute TTL)
- Cache insights and recommendations (15-minute TTL)
- Use `campaign_metrics_cache` table pattern
- Invalidate cache on new snapshot data

### Scalability

- Use batch processing for snapshot collection
- Implement pagination for large result sets
- Use database read replicas for analytics queries
- Consider moving ML training to separate service

---

## Monitoring & Observability

### Metrics to Track

- Snapshot collection success rate
- Attribution event processing latency
- Recommendation generation time
- Dashboard API response times
- ML model accuracy (if applicable)

### Logging

- Log all boost campaign creation events
- Log attribution model calculations
- Log recommendation generation and application
- Log errors in snapshot collection

### Alerts

- Alert on failed snapshot collection jobs
- Alert on attribution event processing errors
- Alert on recommendation generation failures
- Alert on slow dashboard queries (>2s)

---

## Migration Strategy

### Data Backfill (Post-Launch)

If boosted campaigns exist before this feature:

1. Identify existing campaigns linked to organic content (manual or heuristic)
2. Create `boost_campaigns` records retroactively
3. Estimate organic metrics from historical data
4. Mark as `BACKFILLED` in metadata for transparency

### Rollout Plan

**Phase 1** (Week 8): Internal Testing

- Enable for internal workspace only
- Test with real campaigns
- Gather feedback from team

**Phase 2** (Week 9): Beta Users

- Enable for 5-10 beta customers
- Monitor performance and errors
- Iterate based on feedback

**Phase 3** (Week 10): General Availability

- Enable for all workspaces
- Announce feature in product updates
- Publish blog post and documentation

---

## Documentation Requirements

### User-Facing Documentation

**Files to Create**:

- `docs/BOOST_ANALYTICS_USER_GUIDE.md` - End-user guide
- `docs/BOOST_ANALYTICS_BEST_PRACTICES.md` - Tips and strategies
- `docs/BOOST_ANALYTICS_FAQ.md` - Common questions

**Content**:

- What is boost analytics?
- How to interpret effectiveness metrics
- Understanding organic vs paid attribution
- How to use recommendations
- Interpreting insights and best practices
- Troubleshooting common issues

### Developer Documentation

**Files to Create**:

- `docs/BOOST_ANALYTICS_ARCHITECTURE.md` - Technical architecture
- `docs/BOOST_ANALYTICS_API.md` - API reference
- `docs/BOOST_ANALYTICS_ML.md` - ML model documentation

**Content**:

- System architecture diagrams
- Data flow documentation
- Attribution model explanations
- ML feature engineering details
- API endpoint specifications
- Code examples and integration guides

---

## Acceptance Criteria Mapping

### ✅ Boost effectiveness metrics comparing cost per result across campaigns

**Implementation**:

- `boost_performance_snapshots` table tracks cost per result
- `analytics-service.ts` calculates comparative metrics
- Dashboard displays cost per result comparison table
- API endpoint: `GET /api/orbit/boost-analytics?sort=costPerResult`

### ✅ Organic vs paid reach comparison with overlap analysis

**Implementation**:

- `attribution-service.ts` calculates organic/paid/overlap metrics
- `boost_attribution_events` tracks individual touchpoints
- Dashboard shows Venn diagram and side-by-side comparison
- Incremental reach calculation: `paid reach - overlap`

### ✅ Machine learning optimization for future boost timing and targeting

**Implementation**:

- `ml/training-data-aggregator.ts` builds ML training dataset
- `ml/recommendation-engine.ts` generates predictions
- `boost_ml_training_data` table stores features and labels
- Timing and targeting recommendations in `boost_recommendations` table

### ✅ Learning dashboard showing patterns and best practices

**Implementation**:

- `insights/insight-generator.ts` detects patterns
- `insights/best-practices-analyzer.ts` identifies best practices
- `boost_insights` table stores insights
- Dashboard UI displays insights panel with actionable tips

### ✅ Automated recommendations based on feedback loop insights

**Implementation**:

- `automation/recommendation-scheduler.ts` runs daily
- `ml/recommendation-engine.ts` generates recommendations
- `boost_recommendations` table stores recommendations
- One-click apply feature creates boost campaigns

---

## Technical Notes Alignment

### ✅ Create attribution model to separate organic and paid contribution to results

**Implementation**:

- Multiple attribution models: Linear, Time Decay, Position-Based
- `attribution-service.ts` implements model selection
- `boost_attribution_events` table tracks granular events
- Configurable attribution model per workspace

### ✅ Implement A/B testing framework for boost strategies

**Implementation**:

- Leverage existing `SocialPostAbTest` infrastructure
- `testing/strategy-tester.ts` for boost-specific tests
- Statistical significance calculator
- Support for testing timing, budget, targeting, platform

### ✅ Build feedback data pipeline aggregating results into ML training dataset

**Implementation**:

- `ml/training-data-aggregator.ts` aggregates historical data
- `ml/feature-engineering.ts` creates ML features
- `boost_ml_training_data` table stores prepared dataset
- Scheduled job runs weekly to update training data
- Data quality scoring ensures completeness

---

## Dependencies

### External Services

- Marketing platform APIs (Facebook Ads, Google Ads) - Already integrated
- No new external dependencies required

### Internal Dependencies

- Allocator AI Agent (`src/lib/allocator/`) - Already exists
- Social media analytics (`social_metrics`, `social_posts`) - Already exists
- Campaign tracking (`allocator_campaigns`) - Already exists
- Notification system - For recommendation alerts

### New npm Packages

```json
{
  "recharts": "^2.13.3", // Charts and visualizations
  "@types/recharts": "^1.8.29" // TypeScript types
}
```

Optional (for future ML enhancement):

```json
{
  "@tensorflow/tfjs": "^4.22.0", // ML model training (future)
  "simple-statistics": "^7.8.3" // Statistical calculations
}
```

---

## Risks & Mitigations

| Risk                                          | Impact | Likelihood | Mitigation                                                                 |
| --------------------------------------------- | ------ | ---------- | -------------------------------------------------------------------------- |
| Attribution model inaccuracies                | High   | Medium     | Implement multiple models, allow user selection, show confidence intervals |
| Incomplete campaign data from platforms       | High   | Medium     | Graceful degradation, data quality scoring, fallback to estimates          |
| ML recommendations perform poorly             | Medium | Medium     | Start with rule-based system, A/B test recommendations, gradual rollout    |
| Performance impact on database                | Medium | Low        | Implement caching, optimize queries, use read replicas                     |
| Overwhelming users with too many insights     | Low    | Medium     | Prioritize by severity, allow dismissal, limit to top 5 insights           |
| Data privacy concerns with attribution events | High   | Low        | Anonymize data, aggregate metrics, comply with GDPR/CCPA                   |
| Slow dashboard loading                        | Medium | Low        | Implement skeleton loading, lazy loading, optimize queries                 |
| Recommendation generation timing conflicts    | Low    | Low        | Use job queue, prevent concurrent runs, add retry logic                    |

---

## Out of Scope

The following are explicitly **NOT** part of this issue:

- ❌ Automated boost creation without user approval
- ❌ Direct integration with ad platform accounts (use existing Allocator integration)
- ❌ Real-time bidding optimization
- ❌ Video content analysis for boost recommendations
- ❌ Sentiment analysis of user comments
- ❌ Competitor analysis integration
- ❌ Multi-workspace comparison (workspace is isolated)
- ❌ White-label branding for analytics dashboard
- ❌ Email/PDF report generation (future feature)
- ❌ Custom attribution model creation by users

---

## Implementation Timeline

| Phase | Description                  | Duration    | Deliverables                                       |
| ----- | ---------------------------- | ----------- | -------------------------------------------------- |
| 1     | Database Foundation          | 1 week      | Schema migration, TypeScript types, documentation  |
| 2     | Boost Tracking Service       | 1 week      | Boost campaign service, snapshot service, tests    |
| 3     | Attribution Model            | 1 week      | Attribution service, multiple models, integration  |
| 4     | Analytics & Insights Engine  | 1 week      | Analytics service, insight generator, tests        |
| 5     | ML Optimization Engine       | 1 week      | Training data pipeline, recommendation engine      |
| 6     | Learning Dashboard UI        | 1 week      | API endpoints, frontend components, charts         |
| 7     | A/B Testing Framework        | 1 week      | Strategy tester, significance testing, integration |
| 8     | Background Jobs & Automation | 1 week      | Scheduled jobs, monitoring, rollout                |
|       | **Total Estimated Time**     | **8 weeks** |                                                    |

---

## Related Files Reference

| File                                                | Purpose                    | Relevance           |
| --------------------------------------------------- | -------------------------- | ------------------- |
| `prisma/schema.prisma`                              | Database schema            | ✅ Core dependency  |
| `src/lib/allocator/allocator-types.ts`              | Campaign performance types | ✅ Type reference   |
| `src/lib/allocator/allocator-service.ts`            | Budget allocation service  | ✅ Integration      |
| `src/lib/analytics.ts`                              | Event tracking             | ℹ️ Pattern reference |
| `packages/shared/src/types/social-api-responses.ts` | Social media types         | ℹ️ Type reference    |
| `docs/DATABASE_SCHEMA.md`                           | Database documentation     | ℹ️ Update required   |
| `docs/API_REFERENCE.md`                             | API documentation          | ℹ️ Update required   |
| `docs/FEATURES.md`                                  | Product features           | ℹ️ Update required   |

---

## Notes

- This is a **complex, multi-phase implementation** requiring ~8 weeks of focused development
- Leverage existing infrastructure wherever possible (Allocator, social metrics, campaign tracking)
- Prioritize data quality and accuracy over feature completeness
- Start with rule-based recommendations before investing in ML models
- Ensure 100% test coverage for all new code
- Plan for scalability from day one (indexes, caching, batch processing)
- Document everything comprehensively for maintainability

---

## Next Steps

1. **User Approval**: Get sign-off on this implementation plan
2. **Ticket Creation**: Break down into sub-tasks if needed
3. **Sprint Planning**: Allocate resources and set milestones
4. **Phase 1 Start**: Begin with database foundation work
5. **Continuous Feedback**: Review progress weekly, adjust as needed
